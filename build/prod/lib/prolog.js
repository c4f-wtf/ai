var LIB=function(e){var r={};function t(n){if(r[n])return r[n].exports;var i=r[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var i in e)t.d(n,i,function(r){return e[r]}.bind(null,i));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=241)}({20:function(e,r){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(e){"object"==typeof window&&(t=window)}e.exports=t},21:function(e,r,t){"use strict";t.d(r,"d",(function(){return p})),t.d(r,"a",(function(){return l})),t.d(r,"e",(function(){return c})),t.d(r,"b",(function(){return y})),t.d(r,"c",(function(){return w})),t.d(r,"f",(function(){return f}));var n=t(39),i=t.n(n);function a(e,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw new TypeError("attempted to use private field on non-instance");return e}var o=0;function s(e){return"__private_"+o+++"_"+e}async function p(e,r=null,t=self,n=[]){return new Promise((i,a)=>{let o;r&&(o=setTimeout(()=>{a(Error(`message timeout: ${e}`))},r));const s=new MessageChannel;s.port1.onmessage=e=>{clearTimeout(o),e.data&&e.data.result?i(e.data.result):i(void 0)},t.postMessage(e,[s.port2,...n])})}class l{constructor(){Object.defineProperty(this,u,{writable:!0,value:void 0}),Object.defineProperty(this,_,{writable:!0,value:void 0}),this.promise=void 0,this.resolved=!1,this.value=void 0,this.promise=new Promise((e,r)=>{a(this,u)[u]=e,a(this,_)[_]=r})}resolve(e){return this.resolved=!0,this.value=e,a(this,u)[u](e),e}reject(e){this.resolved=!0,a(this,_)[_](e)}}var u=s("resolve"),_=s("reject");function c(e){return i()(e,{replacer:function(e,r){return r instanceof Error?{type:"__ERROR__",message:r.message,stack:r.stack}:r instanceof Function?{type:"__FUNCTION__",name:r.name}:r instanceof Map?{type:"__MAP__",data:[...r]}:r instanceof Set?{type:"__SET__",data:[...r]}:r instanceof Date||"string"==typeof r&&/^\d{4}-[01]\d-[0-3]\dT[012]\d:[0-5]\d:[0-5]\d\.\d{3}Z$/.test(r)?{type:"__DATE__",timestamp:+new Date(r)}:r instanceof Uint8Array?{type:"__Uint8Array__",data:Array.from(r)}:void 0===r?"__UNDEFINED__":r===Number.POSITIVE_INFINITY?"__+INFINITY__":r===Number.NEGATIVE_INFINITY?"__-INFINITY__":Number.isNaN(r)?"__NAN__":r}})}function y(e){return function e(r,t){if(r instanceof Object)for(const[n,i]of Object.entries(r))r[n]=e(i,t);return t(r)}(JSON.parse(e,(function(e,r){if(r instanceof Object){if("__ERROR__"===r.type){const e=Error(r.message);return e.stack=r.stack,e}if("__FUNCTION__"===r.type){const t=self[r.name];return t instanceof Function?t:void console.warn(`Skipped ${e}: Only global functions can be deserialized!`)}if("__MAP__"===r.type)return new Map(r.data);if("__SET__"===r.type)return new Set(r.data);if("__DATE__"===r.type)return new Date(r.timestamp);if("__Uint8Array__"===r.type)return new Uint8Array(r.data)}return"__+INFINITY__"===r?Number.POSITIVE_INFINITY:"__-INFINITY__"===r?Number.NEGATIVE_INFINITY:"__NAN__"===r?NaN:r})),e=>{if("__UNDEFINED__"!==e)return e})}function w(e,r=window){const t=t=>{const n=e.getBoundingClientRect(),i={bubbles:t.bubbles,cancelable:t.cancelable,clientX:t.clientX+n.x,clientY:t.clientY+n.y,pageX:t.pageX+n.x,pageY:t.pageY+n.y,x:t.x+n.x,y:t.y+n.y,offsetX:t.offsetX+n.x,offsetY:t.offsetY+n.y};r.dispatchEvent(new MouseEvent(t.type,i))},n=e=>{r.dispatchEvent(new KeyboardEvent(e.type,e))},i=e.contentWindow;if(!i)throw new d("iframe has no contentWindow");i.onmousedown=t,i.onmousemove=t,i.onmouseup=t,i.onkeydown=n,i.onkeypress=n,i.onkeyup=n}function f(){throw new d("Something went terribly wrong. This should never be called!")}class d extends Error{}},24:function(e,r){e.exports=function(){throw new Error("define cannot be used indirect")}},241:function(e,r,t){"use strict";t.r(r),t.d(r,"pl",(function(){return w}));var n=t(94),i=t.n(n),a=t(95),o=t.n(a),s=t(96),p=t.n(s),l=t(97),u=t.n(l),_=t(98),c=t.n(_),y=t(67);const w=i.a;o()(w),p()(w),u()(w),c()(w),w.type.Session.prototype.consult=async function(e,r){let t=e;".pl"===e.slice(e.length-3)&&(e=Object(y.fixPath)(e),t=await Object(y.getFileContent)(e));const n=this.thread.consult(t,r);if(!0!==n)throw Error(n);return n},w.type.Session.prototype.query=function(e){const r=this.thread.query(e);if(!0!==r)throw Error(r);return r},w.type.Session.prototype.answer=function(){return new Promise((e,r)=>{this.thread.answer(e)})},w.type.Session.prototype.answers=function(e=1e3,r){const t=[];let n=!1;return new Promise((i,a)=>{this.thread.answers((function(e){if(!1===e)n&&t.push(null),i(t);else if(null===e)n=!0;else{if("throw"===e.id)throw Error(e);t.push(e)}}),e,r)})},w.type.Session.prototype.isTrue=function(e){return new Promise((r,t)=>{const n=this.thread;n.query(e),n.answer((function e(t){if(!1!==t){if(null===t&&n.answer(e),"throw"===t.id)throw Error(t);r(!0)}r(!1)}))})},w.type.Session.prototype.run=function(e){return new Promise((r,t)=>{const n=this.thread.query(`${e}`);if(!0!==n)throw Error(n);this.thread.answer(r)})},w.type.Session.prototype.asserta=function(e){return new Promise((r,t)=>{const n=this.thread.query(`asserta(${e}).`);if(!0!==n)throw Error(n);this.thread.answer(r)})},w.type.Session.prototype.assertz=function(e){return new Promise((r,t)=>{const n=this.thread.query(`assertz(${e}).`);if(!0!==n)throw Error(n);this.thread.answer(r)})}},37:function(e,r,t){"use strict";t.d(r,"a",(function(){return n}));t(21);let n,i;!function(e){e[e.LOG=0]="LOG",e[e.JSON_STORE=1]="JSON_STORE",e[e.CALL=2]="CALL",e[e.EVENT=3]="EVENT",e[e.HTML=4]="HTML",e[e.VIDEO=5]="VIDEO"}(n||(n={})),function(e){e[e.RUN=0]="RUN",e[e.TRAIN=1]="TRAIN"}(i||(i={}))},39:function(e,r,t){"use strict";var n=/("(?:[^\\"]|\\.)*")|[:,]/g;e.exports=function(e,r){var t,i,a;return r=r||{},t=JSON.stringify([1],void 0,void 0===r.indent?2:r.indent).slice(2,-3),i=""===t?1/0:void 0===r.maxLength?80:r.maxLength,a=r.replacer,function e(r,o,s){var p,l,u,_,c,y,w,f,d,h,g,m;if(r&&"function"==typeof r.toJSON&&(r=r.toJSON()),void 0===(g=JSON.stringify(r,a)))return g;if(w=i-o.length-s,g.length<=w&&(d=g.replace(n,(function(e,r){return r||e+" "}))).length<=w)return d;if(null!=a&&(r=JSON.parse(g),a=void 0),"object"==typeof r&&null!==r){if(f=o+t,u=[],l=0,Array.isArray(r))for(h="[",p="]",w=r.length;l<w;l++)u.push(e(r[l],f,l===w-1?0:1)||"null");else for(h="{",p="}",w=(y=Object.keys(r)).length;l<w;l++)_=y[l],c=JSON.stringify(_)+": ",void 0!==(m=e(r[_],f,c.length+(l===w-1?0:1)))&&u.push(c+m);if(u.length>0)return[h,t+u.join(",\n"+f),p].join("\n"+o)}return g}(e,"",0)}},41:function(e,r){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},42:function(e,r){(function(r){e.exports=r}).call(this,{})},67:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"seedRandom",(function(){return seedRandom})),__webpack_require__.d(__webpack_exports__,"includeUrl",(function(){return includeUrl})),__webpack_require__.d(__webpack_exports__,"storeJson",(function(){return storeJson})),__webpack_require__.d(__webpack_exports__,"loadJson",(function(){return loadJson})),__webpack_require__.d(__webpack_exports__,"getFileContent",(function(){return getFileContent})),__webpack_require__.d(__webpack_exports__,"fixPath",(function(){return fixPath})),__webpack_require__.d(__webpack_exports__,"initLocalStorage",(function(){return initLocalStorage})),__webpack_require__.d(__webpack_exports__,"localStorage",(function(){return localStorage})),__webpack_require__.d(__webpack_exports__,"console",(function(){return console})),__webpack_require__.d(__webpack_exports__,"getCanvas",(function(){return getCanvas})),__webpack_require__.d(__webpack_exports__,"sleep",(function(){return sleep})),__webpack_require__.d(__webpack_exports__,"setMessages",(function(){return setMessages})),__webpack_require__.d(__webpack_exports__,"addMessage",(function(){return addMessage})),__webpack_require__.d(__webpack_exports__,"loadImages",(function(){return loadImages})),__webpack_require__.d(__webpack_exports__,"getImage",(function(){return getImage})),__webpack_require__.d(__webpack_exports__,"onVideoFrameUpdate",(function(){return onVideoFrameUpdate}));var _util__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(21),_worker_types__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(37),seedrandom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(68),seedrandom__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(seedrandom__WEBPACK_IMPORTED_MODULE_2__);function seedRandom(e){return seedrandom__WEBPACK_IMPORTED_MODULE_2___default()(e)}async function includeUrl(url,context={},parse=(e=>e)){const body=await fetch(url),content=parse(await body.text());function evalInContext(){eval(`${content}`)}return evalInContext.call(context),context}async function storeJson(e,r){const t=(e=fixPath(e,".json")).match(/\/?([^\/]+)\/([^\/]+$)/);if(t){const e=Object(_util__WEBPACK_IMPORTED_MODULE_0__.e)(r),n="global"===t[1]?0:void 0,i={type:_worker_types__WEBPACK_IMPORTED_MODULE_1__.a.JSON_STORE,projectId:n,fileName:t[2],json:e};await Object(_util__WEBPACK_IMPORTED_MODULE_0__.d)(i,1e3).catch(e=>{throw Error(`could not store file ${t[2]}`)})}}async function loadJson(e){e=fixPath(e,".json");const r=await getFileContent(e);return Object(_util__WEBPACK_IMPORTED_MODULE_0__.b)(r)}async function getFileContent(e){e=fixPath(e);const r=await fetch(e);if(200!==r.status)throw Error(`could not open file '${e}'`);return await r.text()}function fixPath(e,r=""){return/^\//.test(e)||(e="/"+e),/^\/(project|global)\//.test(e)||(e="/project"+e),e.endsWith(r)||(e+=r),e}let localStorageCache;async function initLocalStorage(){try{localStorageCache=new Map(await loadJson("localstorage"))}catch(e){localStorageCache=new Map}}function saveLocalStorage(){storeJson("localstorage",localStorageCache)}const localStorage={get length(){return localStorageCache.size},key:e=>e<0||e>=localStorageCache.size?null:Array.from(localStorageCache.keys())[e],setItem(e,r){localStorageCache.set(e,r),saveLocalStorage()},getItem:e=>localStorageCache.has(e)?localStorageCache.get(e):null,removeItem(e){localStorageCache.delete(e)&&saveLocalStorage()},clear(){localStorageCache.clear(),saveLocalStorage()}},console=__console;function getCanvas(){return self.__canvas}async function sleep(e){return new Promise((r,t)=>{setTimeout(r,e)})}async function setMessages(e){const r={type:_worker_types__WEBPACK_IMPORTED_MODULE_1__.a.HTML,action:"set",html:e};await Object(_util__WEBPACK_IMPORTED_MODULE_0__.d)(r)}async function addMessage(e){const r={type:_worker_types__WEBPACK_IMPORTED_MODULE_1__.a.HTML,action:"add",html:e};await Object(_util__WEBPACK_IMPORTED_MODULE_0__.d)(r)}let images=new Map;async function loadImages(e){const r=await Promise.all(e.map(async e=>{const r=e.match(/\/([^\/]+)\.(png|jpeg)$/);let t=e;return r&&r.length>1&&(t=r[1]),{name:t,bitmap:await createImageBitmap(await fetch(e).then(e=>e.blob()))}}));for(const e of r)images.set(e.name,e.bitmap)}function getImage(e){return images.get(e)}function onVideoFrameUpdate(e){self.__onVideoFrameUpdate=e}},68:function(e,r,t){var n=t(78),i=t(79),a=t(80),o=t(81),s=t(82),p=t(83),l=t(84);l.alea=n,l.xor128=i,l.xorwow=a,l.xorshift7=o,l.xor4096=s,l.tychei=p,e.exports=l},78:function(e,r,t){(function(e){var n;!function(e,i,a){function o(e){var r,t=this,n=(r=4022871197,function(e){e=String(e);for(var t=0;t<e.length;t++){var n=.02519603282416938*(r+=e.charCodeAt(t));n-=r=n>>>0,r=(n*=r)>>>0,r+=4294967296*(n-=r)}return 2.3283064365386963e-10*(r>>>0)});t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,r){return r.c=e.c,r.s0=e.s0,r.s1=e.s1,r.s2=e.s2,r}function p(e,r){var t=new o(e),n=r&&r.state,i=t.next;return i.int32=function(){return 4294967296*t.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}i&&i.exports?i.exports=p:t(24)&&t(42)?void 0===(n=function(){return p}.call(r,t,r,i))||(i.exports=n):this.alea=p}(0,e,t(24))}).call(this,t(41)(e))},79:function(e,r,t){(function(e){var n;!function(e,i,a){function o(e){var r=this,t="";r.x=0,r.y=0,r.z=0,r.w=0,r.next=function(){var e=r.x^r.x<<11;return r.x=r.y,r.y=r.z,r.z=r.w,r.w^=r.w>>>19^e^e>>>8},e===(0|e)?r.x=e:t+=e;for(var n=0;n<t.length+64;n++)r.x^=0|t.charCodeAt(n),r.next()}function s(e,r){return r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w,r}function p(e,r){var t=new o(e),n=r&&r.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do{var e=((t.next()>>>11)+(t.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}i&&i.exports?i.exports=p:t(24)&&t(42)?void 0===(n=function(){return p}.call(r,t,r,i))||(i.exports=n):this.xor128=p}(0,e,t(24))}).call(this,t(41)(e))},80:function(e,r,t){(function(e){var n;!function(e,i,a){function o(e){var r=this,t="";r.next=function(){var e=r.x^r.x>>>2;return r.x=r.y,r.y=r.z,r.z=r.w,r.w=r.v,(r.d=r.d+362437|0)+(r.v=r.v^r.v<<4^e^e<<1)|0},r.x=0,r.y=0,r.z=0,r.w=0,r.v=0,e===(0|e)?r.x=e:t+=e;for(var n=0;n<t.length+64;n++)r.x^=0|t.charCodeAt(n),n==t.length&&(r.d=r.x<<10^r.x>>>4),r.next()}function s(e,r){return r.x=e.x,r.y=e.y,r.z=e.z,r.w=e.w,r.v=e.v,r.d=e.d,r}function p(e,r){var t=new o(e),n=r&&r.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do{var e=((t.next()>>>11)+(t.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}i&&i.exports?i.exports=p:t(24)&&t(42)?void 0===(n=function(){return p}.call(r,t,r,i))||(i.exports=n):this.xorwow=p}(0,e,t(24))}).call(this,t(41)(e))},81:function(e,r,t){(function(e){var n;!function(e,i,a){function o(e){var r=this;r.next=function(){var e,t,n=r.x,i=r.i;return e=n[i],t=(e^=e>>>7)^e<<24,t^=(e=n[i+1&7])^e>>>10,t^=(e=n[i+3&7])^e>>>3,t^=(e=n[i+4&7])^e<<7,e=n[i+7&7],t^=(e^=e<<13)^e<<9,n[i]=t,r.i=i+1&7,t},function(e,r){var t,n=[];if(r===(0|r))n[0]=r;else for(r=""+r,t=0;t<r.length;++t)n[7&t]=n[7&t]<<15^r.charCodeAt(t)+n[t+1&7]<<13;for(;n.length<8;)n.push(0);for(t=0;t<8&&0===n[t];++t);for(8==t?n[7]=-1:n[t],e.x=n,e.i=0,t=256;t>0;--t)e.next()}(r,e)}function s(e,r){return r.x=e.x.slice(),r.i=e.i,r}function p(e,r){null==e&&(e=+new Date);var t=new o(e),n=r&&r.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do{var e=((t.next()>>>11)+(t.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=t.next,i.quick=i,n&&(n.x&&s(n,t),i.state=function(){return s(t,{})}),i}i&&i.exports?i.exports=p:t(24)&&t(42)?void 0===(n=function(){return p}.call(r,t,r,i))||(i.exports=n):this.xorshift7=p}(0,e,t(24))}).call(this,t(41)(e))},82:function(e,r,t){(function(e){var n;!function(e,i,a){function o(e){var r=this;r.next=function(){var e,t,n=r.w,i=r.X,a=r.i;return r.w=n=n+1640531527|0,t=i[a+34&127],e=i[a=a+1&127],t^=t<<13,e^=e<<17,t^=t>>>15,e^=e>>>12,t=i[a]=t^e,r.i=a,t+(n^n>>>16)|0},function(e,r){var t,n,i,a,o,s=[],p=128;for(r===(0|r)?(n=r,r=null):(r+="\0",n=0,p=Math.max(p,r.length)),i=0,a=-32;a<p;++a)r&&(n^=r.charCodeAt((a+32)%r.length)),0===a&&(o=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,a>=0&&(o=o+1640531527|0,i=0==(t=s[127&a]^=n+o)?i+1:0);for(i>=128&&(s[127&(r&&r.length||0)]=-1),i=127,a=512;a>0;--a)n=s[i+34&127],t=s[i=i+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,s[i]=n^t;e.w=o,e.X=s,e.i=i}(r,e)}function s(e,r){return r.i=e.i,r.w=e.w,r.X=e.X.slice(),r}function p(e,r){null==e&&(e=+new Date);var t=new o(e),n=r&&r.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do{var e=((t.next()>>>11)+(t.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=t.next,i.quick=i,n&&(n.X&&s(n,t),i.state=function(){return s(t,{})}),i}i&&i.exports?i.exports=p:t(24)&&t(42)?void 0===(n=function(){return p}.call(r,t,r,i))||(i.exports=n):this.xor4096=p}(0,e,t(24))}).call(this,t(41)(e))},83:function(e,r,t){(function(e){var n;!function(e,i,a){function o(e){var r=this,t="";r.next=function(){var e=r.b,t=r.c,n=r.d,i=r.a;return e=e<<25^e>>>7^t,t=t-n|0,n=n<<24^n>>>8^i,i=i-e|0,r.b=e=e<<20^e>>>12^t,r.c=t=t-n|0,r.d=n<<16^t>>>16^i,r.a=i-e|0},r.a=0,r.b=0,r.c=-1640531527,r.d=1367130551,e===Math.floor(e)?(r.a=e/4294967296|0,r.b=0|e):t+=e;for(var n=0;n<t.length+20;n++)r.b^=0|t.charCodeAt(n),r.next()}function s(e,r){return r.a=e.a,r.b=e.b,r.c=e.c,r.d=e.d,r}function p(e,r){var t=new o(e),n=r&&r.state,i=function(){return(t.next()>>>0)/4294967296};return i.double=function(){do{var e=((t.next()>>>11)+(t.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},i.int32=t.next,i.quick=i,n&&("object"==typeof n&&s(n,t),i.state=function(){return s(t,{})}),i}i&&i.exports?i.exports=p:t(24)&&t(42)?void 0===(n=function(){return p}.call(r,t,r,i))||(i.exports=n):this.tychei=p}(0,e,t(24))}).call(this,t(41)(e))},84:function(e,r,t){var n;!function(i,a,o){var s,p=o.pow(256,6),l=o.pow(2,52),u=2*l;function _(e,r,t){var n=[],_=w(function e(r,t){var n,i=[],a=typeof r;if(t&&"object"==a)for(n in r)try{i.push(e(r[n],t-1))}catch(e){}return i.length?i:"string"==a?r:r+"\0"}((r=1==r?{entropy:!0}:r||{}).entropy?[e,f(a)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(256):(e=new Uint8Array(256),(i.crypto||i.msCrypto).getRandomValues(e)),f(e)}catch(e){var r=i.navigator,t=r&&r.plugins;return[+new Date,i,t,i.screen,f(a)]}}():e,3),n),d=new c(n),h=function(){for(var e=d.g(6),r=p,t=0;e<l;)e=256*(e+t),r*=256,t=d.g(1);for(;e>=u;)e/=2,r/=2,t>>>=1;return(e+t)/r};return h.int32=function(){return 0|d.g(4)},h.quick=function(){return d.g(4)/4294967296},h.double=h,w(f(d.S),a),(r.pass||t||function(e,r,t,n){return n&&(n.S&&y(n,d),e.state=function(){return y(d,{})}),t?(o.random=e,r):e})(h,_,"global"in r?r.global:this==o,r.state)}function c(e){var r,t=e.length,n=this,i=0,a=n.i=n.j=0,o=n.S=[];for(t||(e=[t++]);i<256;)o[i]=i++;for(i=0;i<256;i++)o[i]=o[a=255&a+e[i%t]+(r=o[i])],o[a]=r;(n.g=function(e){for(var r,t=0,i=n.i,a=n.j,o=n.S;e--;)r=o[i=255&i+1],t=256*t+o[255&(o[i]=o[a=255&a+r])+(o[a]=r)];return n.i=i,n.j=a,t})(256)}function y(e,r){return r.i=e.i,r.j=e.j,r.S=e.S.slice(),r}function w(e,r){for(var t,n=e+"",i=0;i<n.length;)r[255&i]=255&(t^=19*r[255&i])+n.charCodeAt(i++);return f(r)}function f(e){return String.fromCharCode.apply(0,e)}if(w(o.random(),a),e.exports){e.exports=_;try{s=t(85)}catch(e){}}else void 0===(n=function(){return _}.call(r,t,r,e))||(e.exports=n)}("undefined"!=typeof self?self:this,[],Math)},85:function(e,r){},94:function(e,r,t){(function(r){!function(){var t,n={major:0,minor:2,patch:73,status:"beta"},i={files:{},open:function(e,r,t){var n=i.files[e];if(!n){if("read"===t)return null;n={path:e,text:"",type:r,get:function(e,r){return r===this.text.length?"end_of_file":r>this.text.length?"end_of_file":this.text.substring(r,r+e)},put:function(e,r){return"end_of_file"===r?(this.text+=e,!0):"past_end_of_file"===r?null:(this.text=this.text.substring(0,r)+e+this.text.substring(r+e.length),!0)},get_byte:function(e){if("end_of_stream"===e)return-1;var r=Math.floor(e/2);if(this.text.length<=r)return-1;var t=l(this.text[Math.floor(e/2)],0);return e%2==0?255&t:t/256>>>0},put_byte:function(e,r){var t="end_of_stream"===r?this.text.length:Math.floor(r/2);if(this.text.length<t)return null;var n=this.text.length===t?-1:l(this.text[Math.floor(r/2)],0);return n=r%2==0?(255&(n=n/256>>>0))<<8|255&e:(255&e)<<8|255&(n&=255),this.text.length===t?this.text+=u(n):this.text=this.text.substring(0,t)+u(n)+this.text.substring(t+1),!0},flush:function(){return!0},close:function(){return!!i.files[this.path]||null}},i.files[e]=n}return"write"===t&&(n.text=""),n}},a={buffer:"",get:function(e,r){for(var t;a.buffer.length<e;)(t=window.prompt())&&(a.buffer+=t);return t=a.buffer.substr(0,e),a.buffer=a.buffer.substr(e),t}},o={put:function(e,r){return console.log(e),!0},flush:function(){return!0}};t=Array.prototype.indexOf?function(e,r){return e.indexOf(r)}:function(e,r){for(var t=e.length,n=0;n<t;n++)if(r===e[n])return n;return-1};var s,p,l,u,_,c=function(e,r){if(0!==e.length){for(var t=e[0],n=e.length,i=1;i<n;i++)t=r(t,e[i]);return t}};s=Array.prototype.map?function(e,r){return e.map(r)}:function(e,r){for(var t=[],n=e.length,i=0;i<n;i++)t.push(r(e[i]));return t},p=Array.prototype.filter?function(e,r){return e.filter(r)}:function(e,r){for(var t=[],n=e.length,i=0;i<n;i++)r(e[i])&&t.push(e[i]);return t},l=String.prototype.codePointAt?function(e,r){return e.codePointAt(r)}:function(e,r){return e.charCodeAt(r)},u=String.fromCodePoint?function(){return String.fromCodePoint.apply(null,arguments)}:function(){return String.fromCharCode.apply(null,arguments)};var y=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;_=Array.from?function(e){return Array.from(e).length}:function(e){return e.replace(y,"_").length};var w=/(\\a)|(\\b)|(\\f)|(\\n)|(\\r)|(\\t)|(\\v)|\\x([0-9a-fA-F]+)\\|\\([0-7]+)\\|(\\\\)|(\\')|('')|(\\")|(\\`)|(\\.)|(.)/g,f={"\\a":7,"\\b":8,"\\f":12,"\\n":10,"\\r":13,"\\t":9,"\\v":11};function d(e,r){var t="";if("\\"===e)return null;if(e.length<2)return e;try{e=(e=e.replace(/\\([0-7]+)\\/g,(function(e,r){return u(parseInt(r,8))}))).replace(/\\x([0-9a-fA-F]+)\\/g,(function(e,r){return u(parseInt(r,16))}))}catch(e){return null}for(var n=0;n<e.length;n++){var i=e.charAt(n),a=e.charAt(n+1);if(i===r&&a===r)n++,t+=r;else if("\\"===i){if(-1===["a","b","f","n","r","t","v","'",'"',"\\","a","\b","\f","\n","\r","\t","\v"].indexOf(a))return null;switch(n+=1,a){case"a":t+="a";break;case"b":t+="\b";break;case"f":t+="\f";break;case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"v":t+="\v";break;case"'":t+="'";break;case'"':t+='"';break;case"\\":t+="\\"}}else t+=i}return t}function h(e){var r,t,n,i=e.substr(2);switch(e.substr(0,2).toLowerCase()){case"0x":return parseInt(i,16);case"0b":return parseInt(i,2);case"0o":return parseInt(i,8);case"0'":return(r=i,t=[],n=!1,r.replace(w,(function(e,r,i,a,o,s,p,u,_,c,y,w,d,h,g,m,v){switch(!0){case void 0!==_:return t.push(parseInt(_,16)),"";case void 0!==c:return t.push(parseInt(c,8)),"";case void 0!==y:case void 0!==w:case void 0!==d:case void 0!==h:case void 0!==g:return t.push(l(e.substr(1),0)),"";case void 0!==v:return t.push(l(v,0)),"";case void 0!==m:n=!0;default:return t.push(f[e]),""}})),n?null:t)[0];default:return parseFloat(e)}}var g={whitespace:/^\s*(?:(?:%.*)|(?:\/\*(?:\n|\r|.)*?\*\/)|(?:\s+))\s*/,variable:/^(?:[A-Z_][a-zA-Z0-9_]*)/,atom:/^(\!|,|;|[a-z][0-9a-zA-Z_]*|[#\$\&\*\+\-\.\/\:\<\=\>\?\@\^\~\\]+|'(?:(?:'')|(?:\\')|[^'])*')/,number:/^(?:0o[0-7]+|0x[0-9a-fA-F]+|0b[01]+|0'(?:''|\\[abfnrtv\\'"`]|\\x?\d+\\|[^\\])|\d+(?:\.\d+(?:[eE][+-]?\d+)?)?)/,string:/^(?:"([^"]|""|\\")*"|`([^`]|``|\\`)*`)/,l_brace:/^(?:\[)/,r_brace:/^(?:\])/,l_bracket:/^(?:\{)/,r_bracket:/^(?:\})/,bar:/^(?:\|)/,l_paren:/^(?:\()/,r_paren:/^(?:\))/};function m(e){this.thread=e,this.text="",this.tokens=[]}function v(e,r,t,n,i){if(!r[t])return{type:0,value:J.error.syntax(r[t-1],"expression expected",!0)};if("0"===n){switch((_=r[t]).name){case"number":return{type:1,len:t+1,value:new J.type.Num(_.value,_.float)};case"variable":return{type:1,len:t+1,value:new J.type.Var(_.value)};case"string":var a;switch(e.get_flag("double_quotes").id){case"atom":a=new I(_.value,[]);break;case"codes":a=new I("[]",[]);for(var o=_.value.length-1;o>=0;o--)a=new I(".",[new J.type.Num(l(_.value,o),!1),a]);break;case"chars":a=new I("[]",[]);for(o=_.value.length-1;o>=0;o--)a=new I(".",[new J.type.Term(_.value.charAt(o),[]),a])}return{type:1,len:t+1,value:a};case"l_paren":return 1!==(c=v(e,r,t+1,e.__get_max_priority(),!0)).type?c:r[c.len]&&"r_paren"===r[c.len].name?(c.len++,c):{type:0,derived:!0,value:J.error.syntax(r[c.len]?r[c.len]:r[c.len-1],") or operator expected",!r[c.len])};case"l_bracket":return 1!==(c=v(e,r,t+1,e.__get_max_priority(),!0)).type?c:r[c.len]&&"r_bracket"===r[c.len].name?(c.len++,c.value=new I("{}",[c.value]),c):{type:0,derived:!0,value:J.error.syntax(r[c.len]?r[c.len]:r[c.len-1],"} or operator expected",!r[c.len])}}var s=function(e,r,t,n){if(!r[t]||"atom"===r[t].name&&"."===r[t].raw&&!n&&(r[t].space||!r[t+1]||"l_paren"!==r[t+1].name))return{type:0,derived:!1,value:J.error.syntax(r[t-1],"unfounded token")};var i=r[t],a=[];if("atom"===r[t].name&&","!==r[t].raw){if(t++,r[t-1].space)return{type:1,len:t,value:new J.type.Term(i.value,a)};if(r[t]&&"l_paren"===r[t].name){if(r[t+1]&&"r_paren"===r[t+1].name)return{type:0,derived:!0,value:J.error.syntax(r[t+1],"argument expected")};var o=v(e,r,++t,"999",!0);if(0===o.type)return o.derived?o:{type:0,derived:!0,value:J.error.syntax(r[t]?r[t]:r[t-1],"argument expected",!r[t])};for(a.push(o.value),t=o.len;r[t]&&"atom"===r[t].name&&","===r[t].value;){if(0===(o=v(e,r,t+1,"999",!0)).type)return o.derived?o:{type:0,derived:!0,value:J.error.syntax(r[t+1]?r[t+1]:r[t],"argument expected",!r[t+1])};a.push(o.value),t=o.len}if(!r[t]||"r_paren"!==r[t].name)return{type:0,derived:!0,value:J.error.syntax(r[t]?r[t]:r[t-1],", or ) expected",!r[t])};t++}return{type:1,len:t,value:new J.type.Term(i.value,a)}}return{type:0,derived:!1,value:J.error.syntax(r[t],"term expected")}}(e,r,t,i);return 1===s.type||s.derived?s:1===(s=function(e,r,t){if(!r[t])return{type:0,derived:!1,value:J.error.syntax(r[t-1],"[ expected")};if(r[t]&&"l_brace"===r[t].name){var n=v(e,r,++t,"999",!0),i=[n.value],a=void 0;if(0===n.type)return r[t]&&"r_brace"===r[t].name?{type:1,len:t+1,value:new J.type.Term("[]",[])}:{type:0,derived:!0,value:J.error.syntax(r[t],"] expected")};for(t=n.len;r[t]&&"atom"===r[t].name&&","===r[t].value;){if(0===(n=v(e,r,t+1,"999",!0)).type)return n.derived?n:{type:0,derived:!0,value:J.error.syntax(r[t+1]?r[t+1]:r[t],"argument expected",!r[t+1])};i.push(n.value),t=n.len}var o=!1;if(r[t]&&"bar"===r[t].name){if(o=!0,0===(n=v(e,r,t+1,"999",!0)).type)return n.derived?n:{type:0,derived:!0,value:J.error.syntax(r[t+1]?r[t+1]:r[t],"argument expected",!r[t+1])};a=n.value,t=n.len}return r[t]&&"r_brace"===r[t].name?{type:1,len:t+1,value:V(i,a)}:{type:0,derived:!0,value:J.error.syntax(r[t]?r[t]:r[t-1],o?"] expected":", or | or ] expected",!r[t])}}return{type:0,derived:!1,value:J.error.syntax(r[t],"list expected")}}(e,r,t)).type||s.derived?s:{type:0,derived:!1,value:J.error.syntax(r[t],"unexpected token")}}e.__get_max_priority();var p=e.__get_next_priority(n),u=t;if("atom"===r[t].name&&r[t+1]&&(r[t].space||"l_paren"!==r[t+1].name)){var _=r[t++];if((f=e.__lookup_operator_classes(n,_.value))&&f.indexOf("fy")>-1){if(0!==(c=v(e,r,t,n,i)).type)return"-"===_.value&&!_.space&&J.type.is_number(c.value)?{value:new J.type.Num(-c.value.value,c.value.is_float),len:c.len,type:1}:{value:new J.type.Term(_.value,[c.value]),len:c.len,type:1};c}else if(f&&f.indexOf("fx")>-1){var c;if(0!==(c=v(e,r,t,p,i)).type)return{value:new J.type.Term(_.value,[c.value]),len:c.len,type:1};c}}if(1===(c=v(e,r,t=u,p,i)).type){_=r[t=c.len];if(r[t]&&("atom"===r[t].name&&e.__lookup_operator_classes(n,_.value)||"bar"===r[t].name&&e.__lookup_operator_classes(n,"|"))){var y=p,w=n;if((f=e.__lookup_operator_classes(n,_.value)).indexOf("xf")>-1)return{value:new J.type.Term(_.value,[c.value]),len:++c.len,type:1};if(f.indexOf("xfx")>-1)return 1===(d=v(e,r,t+1,y,i)).type?{value:new J.type.Term(_.value,[c.value,d.value]),len:d.len,type:1}:(d.derived=!0,d);if(f.indexOf("xfy")>-1)return 1===(d=v(e,r,t+1,w,i)).type?{value:new J.type.Term(_.value,[c.value,d.value]),len:d.len,type:1}:(d.derived=!0,d);if(0!==c.type)for(;;){var f;if(!(_=r[t=c.len])||"atom"!==_.name||!e.__lookup_operator_classes(n,_.value))break;if((f=e.__lookup_operator_classes(n,_.value)).indexOf("yf")>-1)c={value:new J.type.Term(_.value,[c.value]),len:++t,type:1};else{if(!(f.indexOf("yfx")>-1))break;var d;if(0===(d=v(e,r,++t,y,i)).type)return d.derived=!0,d;t=d.len,c={value:new J.type.Term(_.value,[c.value,d.value]),len:t,type:1}}}}else({type:0,value:J.error.syntax(r[c.len-1],"operator expected")});return c}return c}function b(e,r,t){var n,i=r[t].line,a=v(e,r,t,e.__get_max_priority(),!1),o=null;if(0!==a.type){if(r[t=a.len]&&"atom"===r[t].name&&"."===r[t].raw){if(t++,J.type.is_term(a.value)){if(":-/2"===a.value.indicator)n={value:o=new J.type.Rule(a.value.args[0],T(a.value.args[1])),len:t,type:1};else if("--\x3e/2"===a.value.indicator){if(o=function(e,r){e=e.rename(r);var t=r.next_free_variable(),n=x(e.body,t,r);if(n.error)return n.value;if(e.body=n.value,",/2"===e.head.indicator){var i=e.head.args[1];e.head=e.head.args[0];var a=r.next_free_variable(),o=i;if(!J.type.is_list(o))return J.error.type("list",o,"DCG/0");if("[]/0"===o.indicator)i=n.variable;else{for(;"./2"===o.indicator&&J.type.is_list(o)&&"[]/0"!==o.args[1].indicator;)o=o.args[1];if(J.type.is_variable(o))return J.error.instantiation("DCG/0");if(!J.type.is_list(o))return J.error.type("list",i,"DCG/0");o.args[1]=n.variable}e.body=new I(",",[e.body,new I("=",[a,i])]),e.head.args=e.head.args.concat([t,a]),e.head=new I(e.head.id,e.head.args)}else{a=r.next_free_variable();e.head.args=e.head.args.concat([t,a]),e.head=new I(e.head.id,e.head.args),e.body=new I(",",[e.body,new I("=",[n.variable,a])])}return e}(new J.type.Rule(a.value.args[0],a.value.args[1]),e),!J.type.is_rule(o))return{value:o,len:t,type:0};o.body=T(o.body),n={value:o,len:t,type:J.type.is_rule(o)?1:0}}else n={value:o=new J.type.Rule(a.value,null),len:t,type:1};if(o){var s=o.singleton_variables();s.length>0&&e.throw_warning(J.warning.singleton(s,o.head.indicator,i))}return n}return{type:0,value:J.error.syntax(r[t],"callable expected")}}return{type:0,value:J.error.syntax(r[t]?r[t]:r[t-1],". or operator expected")}}return a}function x(e,r,t){var n;if(J.type.is_term(e)&&"!/0"===e.indicator)return{value:e,variable:r,error:!1};if(J.type.is_term(e)&&",/2"===e.indicator){var i=x(e.args[0],r,t);if(i.error)return i;var a=x(e.args[1],i.variable,t);return a.error?a:{value:new I(",",[i.value,a.value]),variable:a.variable,error:!1}}if(J.type.is_term(e)&&"{}/1"===e.indicator)return{value:e.args[0],variable:r,error:!1};if(J.type.is_empty_list(e))return{value:new I("true",[]),variable:r,error:!1};if(J.type.is_list(e)){n=t.next_free_variable();for(var o,s=e;"./2"===s.indicator;)o=s,s=s.args[1];return J.type.is_variable(s)?{value:J.error.instantiation("DCG/0"),variable:r,error:!0}:J.type.is_empty_list(s)?(o.args[1]=n,{value:new I("=",[r,e]),variable:n,error:!1}):{value:J.error.type("list",e,"DCG/0"),variable:r,error:!0}}return J.type.is_callable(e)?(n=t.next_free_variable(),e.args=e.args.concat([r,n]),{value:e=new I(e.id,e.args),variable:n,error:!1}):{value:J.error.type("callable",e,"DCG/0"),variable:r,error:!0}}function T(e){return J.type.is_variable(e)?new I("call",[e]):J.type.is_term(e)&&-1!==[",/2",";/2","->/2"].indexOf(e.indicator)?new I(e.id,[T(e.args[0]),T(e.args[1])]):e}function V(e,r){for(var t=r||new J.type.Term("[]",[]),n=e.length-1;n>=0;n--)t=new J.type.Term(".",[e[n],t]);return t}function S(e){for(var r={},t=[],n=0;n<e.length;n++)e[n]in r||(t.push(e[n]),r[e[n]]=!0);return t}function k(e){return function(r,t,n){var i=n.args[0],a=n.args.slice(1,e);if(J.type.is_variable(i))r.throw_error(J.error.instantiation(r.level));else if(J.type.is_callable(i)){var o=new I(i.id,i.args.concat(a));r.prepend([new R(t.goal.replace(o),t.substitution,t)])}else r.throw_error(J.error.type("callable",i,r.level))}}function O(e){for(var r=e.length-1;r>=0;r--)if("/"===e.charAt(r))return new I("/",[new I(e.substring(0,r)),new E(parseInt(e.substring(r+1)),!1)])}function P(e){this.id=e}function E(e,r){this.is_float=void 0!==r?r:parseInt(e)!==e,this.value=this.is_float?e:parseInt(e)}m.prototype.set_last_tokens=function(e){return this.tokens=e},m.prototype.new_text=function(e){this.text=e,this.tokens=[]},m.prototype.get_tokens=function(e){var r,t=0,n=0,i=0,a=[];e?(t=(u=this.tokens[e-1]).len,r=function(e,r){return"on"===e.get_flag("char_conversion").id?r.replace(/./g,(function(r){return e.get_char_conversion(r)})):r}(this.thread,this.text.substr(u.len)),n=u.line,i=u.start):r=this.text;if(/^\s*$/.test(r))return null;for(;""!==r;){var o=[],s=!1;if(null===/^\n/.exec(r)){for(var p in g)if(g.hasOwnProperty(p)){var l=g[p].exec(r);l&&o.push({value:l[0],name:p,matches:l})}if(!o.length)return this.set_last_tokens([{value:r,matches:[],name:"lexical",line:n,start:i}]);var u;switch((u=c(o,(function(e,r){return e.value.length>=r.value.length?e:r}))).start=i,u.line=n,r=r.replace(u.value,""),i+=u.value.length,t+=u.value.length,u.name){case"atom":u.raw=u.value,"'"===u.value.charAt(0)&&(u.value=d(u.value.substr(1,u.value.length-2),"'"),null===u.value&&(u.name="lexical",u.value="unknown escape sequence"));break;case"number":u.float="0x"!==u.value.substring(0,2)&&null!==u.value.match(/[.eE]/)&&"0'."!==u.value,u.value=h(u.value),u.blank=s;break;case"string":var _=u.value.charAt(0);u.value=d(u.value.substr(1,u.value.length-2),_),null===u.value&&(u.name="lexical",u.value="unknown escape sequence");break;case"whitespace":var y=a[a.length-1];y&&(y.space=!0),s=!0;continue;case"r_bracket":a.length>0&&"l_bracket"===a[a.length-1].name&&((u=a.pop()).name="atom",u.value="{}",u.raw="{}",u.space=!1);break;case"r_brace":a.length>0&&"l_brace"===a[a.length-1].name&&((u=a.pop()).name="atom",u.value="[]",u.raw="[]",u.space=!1)}u.len=t,a.push(u),s=!1}else n++,i=0,t++,r=r.replace(/\n/,""),!0}var w=this.set_last_tokens(a);return 0===w.length?null:w};var N=0;function I(e,r,t){this.ref=t||++N,this.id=e,this.args=r||[],this.indicator=e+"/"+this.args.length}var M=0;function A(e,r,t,n,i,a){this.id=M++,this.stream=e,this.mode=r,this.alias=t,this.type=void 0!==n?n:"text",this.reposition=void 0===i||i,this.eof_action=void 0!==a?a:"eof_code",this.position="append"===this.mode?"end_of_stream":0,this.output="write"===this.mode||"append"===this.mode,this.input="read"===this.mode}function j(e){e=e||{},this.links=e}function R(e,r,t){r=r||new j,t=t||null,this.goal=e,this.substitution=r,this.parent=t}function X(e,r,t){this.head=e,this.body=r,this.dynamic=t||!1}function C(e){e=void 0===e||e<=0?1e3:e,this.rules={},this.src_predicates={},this.rename=0,this.modules=[],this.thread=new q(this),this.total_threads=1,this.renamed_variables={},this.public_predicates={},this.multifile_predicates={},this.limit=e,this.streams={user_input:new A(a,"read","user_input","text",!1,"reset"),user_output:new A(o,"write","user_output","text",!1,"eof_code")},this.file_system=i,this.standard_input=this.streams.user_input,this.standard_output=this.streams.user_output,this.current_input=this.streams.user_input,this.current_output=this.streams.user_output,this.format_success=function(e){return e.substitution},this.format_error=function(e){return e.goal},this.flag={bounded:J.flag.bounded.value,max_integer:J.flag.max_integer.value,min_integer:J.flag.min_integer.value,integer_rounding_function:J.flag.integer_rounding_function.value,char_conversion:J.flag.char_conversion.value,debug:J.flag.debug.value,max_arity:J.flag.max_arity.value,unknown:J.flag.unknown.value,double_quotes:J.flag.double_quotes.value,occurs_check:J.flag.occurs_check.value,dialect:J.flag.dialect.value,version_data:J.flag.version_data.value,nodejs:J.flag.nodejs.value},this.__loaded_modules=[],this.__char_conversion={},this.__operators={1200:{":-":["fx","xfx"],"--\x3e":["xfx"],"?-":["fx"]},1100:{";":["xfy"]},1050:{"->":["xfy"]},1e3:{",":["xfy"]},900:{"\\+":["fy"]},700:{"=":["xfx"],"\\=":["xfx"],"==":["xfx"],"\\==":["xfx"],"@<":["xfx"],"@=<":["xfx"],"@>":["xfx"],"@>=":["xfx"],"=..":["xfx"],is:["xfx"],"=:=":["xfx"],"=\\=":["xfx"],"<":["xfx"],"=<":["xfx"],">":["xfx"],">=":["xfx"]},600:{":":["xfy"]},500:{"+":["yfx"],"-":["yfx"],"/\\":["yfx"],"\\/":["yfx"]},400:{"*":["yfx"],"/":["yfx"],"//":["yfx"],rem:["yfx"],mod:["yfx"],"<<":["yfx"],">>":["yfx"]},200:{"**":["xfx"],"^":["xfy"],"-":["fy"],"+":["fy"],"\\":["fy"]}}}function q(e){this.epoch=Date.now(),this.session=e,this.session.total_threads++,this.total_steps=0,this.cpu_time=0,this.cpu_time_last=0,this.points=[],this.debugger=!1,this.debugger_states=[],this.level="top_level/0",this.__calls=[],this.current_limit=this.session.limit,this.warnings=[]}function D(e,r,t){this.id=e,this.rules=r,this.exports=t,J.module[e]=this}D.prototype.exports_predicate=function(e){return-1!==this.exports.indexOf(e)},P.prototype.unify=function(e,r){if(r&&-1!==t(e.variables(),this.id)&&!J.type.is_variable(e))return null;var n={};return n[this.id]=e,new j(n)},E.prototype.unify=function(e,r){return J.type.is_number(e)&&this.value===e.value&&this.is_float===e.is_float?new j:null},I.prototype.unify=function(e,r){if(J.type.is_term(e)&&this.indicator===e.indicator){for(var t=new j,n=0;n<this.args.length;n++){var i=J.unify(this.args[n].apply(t),e.args[n].apply(t),r);if(null===i)return null;for(var a in i.links)t.links[a]=i.links[a];t=t.apply(i)}return t}return null},A.prototype.unify=function(e,r){return J.type.is_stream(e)&&this.id===e.id?new j:null},P.prototype.toString=function(e){return this.id},E.prototype.toString=function(e){return this.is_float&&-1===t(this.value.toString(),".")?this.value+".0":this.value.toString()},I.prototype.toString=function(e,r,t){if((e=e||{}).quoted=void 0===e.quoted||e.quoted,e.ignore_ops=void 0!==e.ignore_ops&&e.ignore_ops,e.numbervars=void 0!==e.numbervars&&e.numbervars,r=void 0===r?{priority:1200,class:"",indicator:""}:r,t=void 0===t?"":t,e.numbervars&&"$VAR/1"===this.indicator&&J.type.is_integer(this.args[0])&&this.args[0].value>=0){var n=this.args[0].value,i=Math.floor(n/26);return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[n%26]+(0!==i?i:"")}switch(this.indicator){case"[]/0":case"{}/0":case"!/0":return this.id;case"{}/1":return"{"+this.args[0].toString(e)+"}";case"./2":if(!1===e.ignore_ops){for(var a="["+this.args[0].toString(e),o=this.args[1];"./2"===o.indicator;)a+=", "+o.args[0].toString(e),o=o.args[1];return"[]/0"!==o.indicator&&(a+="|"+o.toString(e)),a+="]"}default:var p=this.id,l=e.session?e.session.lookup_operator(this.id,this.args.length):null;if(void 0===e.session||e.ignore_ops||null===l)return e.quoted&&!/^(!|[a-z][0-9a-zA-Z_]*)$/.test(p)&&"{}"!==p&&"[]"!==p&&(p="'"+function(e){for(var r="",t=0;t<e.length;t++)switch(e.charAt(t)){case"'":r+="\\'";break;case"\\":r+="\\\\";break;case"\b":r+="\\b";break;case"\f":r+="\\f";break;case"\n":r+="\\n";break;case"\r":r+="\\r";break;case"\t":r+="\\t";break;case"\v":r+="\\v";break;default:r+=e.charAt(t)}return r}(p)+"'"),p+(this.args.length?"("+s(this.args,(function(r){return r.toString(e)})).join(", ")+")":"");var u=parseInt(l.priority),_=parseInt(r.priority),c=u>_||u===_&&("xfx"===l.class||"xfy"===l.class&&this.indicator!==r.indicator||"yfx"===l.class&&this.indicator!==r.indicator||this.indicator===r.indicator&&"yfx"===l.class&&"right"===t||this.indicator===r.indicator&&"xfy"===l.class&&"left"===t);l.indicator=this.indicator;var y=c?"(":"",w=c?")":"";return 0===this.args.length?"("+this.id+")":-1!==["fy","fx"].indexOf(l.class)?y+p+" "+this.args[0].toString(e,l)+w:-1!==["yf","xf"].indexOf(l.class)?y+this.args[0].toString(e,l)+" "+p+w:y+this.args[0].toString(e,l,"left")+" "+this.id+" "+this.args[1].toString(e,l,"right")+w}},A.prototype.toString=function(e){return"<stream>("+this.id+")"},j.prototype.toString=function(e){var r="{";for(var t in this.links)this.links.hasOwnProperty(t)&&("{"!==r&&(r+=", "),r+=t+"/"+this.links[t].toString(e));return r+="}"},R.prototype.toString=function(e){return null===this.goal?"<"+this.substitution.toString(e)+">":"<"+this.goal.toString(e)+", "+this.substitution.toString(e)+">"},X.prototype.toString=function(e){return this.body?this.head.toString(e)+" :- "+this.body.toString(e)+".":this.head.toString(e)+"."},C.prototype.toString=function(e){for(var r="",t=0;t<this.modules.length;t++)r+=":- use_module(library("+this.modules[t]+")).\n";for(key in r+="\n",this.rules)for(t=0;t<this.rules[key].length;t++)r+=this.rules[key][t].toString(e),r+="\n";return r},P.prototype.clone=function(){return new P(this.id)},E.prototype.clone=function(){return new E(this.value,this.is_float)},I.prototype.clone=function(){return new I(this.id,s(this.args,(function(e){return e.clone()})))},A.prototype.clone=function(){return new Stram(this.stream,this.mode,this.alias,this.type,this.reposition,this.eof_action)},j.prototype.clone=function(){var e={};for(var r in this.links)this.links.hasOwnProperty(r)&&(e[r]=this.links[r].clone());return new j(e)},R.prototype.clone=function(){return new R(this.goal.clone(),this.substitution.clone(),this.parent)},X.prototype.clone=function(){return new X(this.head.clone(),null!==this.body?this.body.clone():null)},P.prototype.equals=function(e){return J.type.is_variable(e)&&this.id===e.id},E.prototype.equals=function(e){return J.type.is_number(e)&&this.value===e.value&&this.is_float===e.is_float},I.prototype.equals=function(e){if(!J.type.is_term(e)||this.indicator!==e.indicator)return!1;for(var r=0;r<this.args.length;r++)if(!this.args[r].equals(e.args[r]))return!1;return!0},A.prototype.equals=function(e){return J.type.is_stream(e)&&this.id===e.id},j.prototype.equals=function(e){var r;if(!J.type.is_substitution(e))return!1;for(r in this.links)if(this.links.hasOwnProperty(r)&&(!e.links[r]||!this.links[r].equals(e.links[r])))return!1;for(r in e.links)if(e.links.hasOwnProperty(r)&&!this.links[r])return!1;return!0},R.prototype.equals=function(e){return J.type.is_state(e)&&this.goal.equals(e.goal)&&this.substitution.equals(e.substitution)&&this.parent===e.parent},X.prototype.equals=function(e){return J.type.is_rule(e)&&this.head.equals(e.head)&&(null===this.body&&null===e.body||null!==this.body&&this.body.equals(e.body))},P.prototype.rename=function(e){return e.get_free_variable(this)},E.prototype.rename=function(e){return this},I.prototype.rename=function(e){return new I(this.id,s(this.args,(function(r){return r.rename(e)})))},A.prototype.rename=function(e){return this},X.prototype.rename=function(e){return new X(this.head.rename(e),null!==this.body?this.body.rename(e):null)},P.prototype.variables=function(){return[this.id]},E.prototype.variables=function(){return[]},I.prototype.variables=function(){return[].concat.apply([],s(this.args,(function(e){return e.variables()})))},A.prototype.variables=function(){return[]},X.prototype.variables=function(){return null===this.body?this.head.variables():this.head.variables().concat(this.body.variables())},P.prototype.apply=function(e){return e.lookup(this.id)?e.lookup(this.id):this},E.prototype.apply=function(e){return this},I.prototype.apply=function(e){if("./2"===this.indicator){for(var r=[],t=this;"./2"===t.indicator;)r.push(t.args[0].apply(e)),t=t.args[1];for(var n=t.apply(e),i=r.length-1;i>=0;i--)n=new I(".",[r[i],n]);return n}return new I(this.id,s(this.args,(function(r){return r.apply(e)})),this.ref)},A.prototype.apply=function(e){return this},X.prototype.apply=function(e){return new X(this.head.apply(e),null!==this.body?this.body.apply(e):null)},j.prototype.apply=function(e){var r,t={};for(r in this.links)this.links.hasOwnProperty(r)&&(t[r]=this.links[r].apply(e));return new j(t)},I.prototype.select=function(){for(var e=this;",/2"===e.indicator;)e=e.args[0];return e},I.prototype.replace=function(e){return",/2"===this.indicator?",/2"===this.args[0].indicator?new I(",",[this.args[0].replace(e),this.args[1]]):null===e?this.args[1]:new I(",",[e,this.args[1]]):e},I.prototype.search=function(e){if(J.type.is_term(e)&&void 0!==e.ref&&this.ref===e.ref)return!0;for(var r=0;r<this.args.length;r++)if(J.type.is_term(this.args[r])&&this.args[r].search(e))return!0;return!1},C.prototype.get_current_input=function(){return this.current_input},q.prototype.get_current_input=function(){return this.session.get_current_input()},C.prototype.get_current_output=function(){return this.current_output},q.prototype.get_current_output=function(){return this.session.get_current_output()},C.prototype.set_current_input=function(e){this.current_input=e},q.prototype.set_current_input=function(e){return this.session.set_current_input(e)},C.prototype.set_current_output=function(e){this.current_input=e},q.prototype.set_current_output=function(e){return this.session.set_current_output(e)},C.prototype.get_stream_by_alias=function(e){return this.streams[e]},q.prototype.get_stream_by_alias=function(e){return this.session.get_stream_by_alias(e)},C.prototype.file_system_open=function(e,r,t){return this.file_system.open(e,r,t)},q.prototype.file_system_open=function(e,r,t){return this.session.file_system_open(e,r,t)},C.prototype.get_char_conversion=function(e){return this.__char_conversion[e]||e},q.prototype.get_char_conversion=function(e){return this.session.get_char_conversion(e)},C.prototype.parse=function(e){return this.thread.parse(e)},q.prototype.parse=function(e){var r=new m(this);r.new_text(e);var t=r.get_tokens();if(null===t)return!1;var n=v(this,t,0,this.__get_max_priority(),!1);return n.len===t.length&&{value:n.value,expr:n,tokens:t}},C.prototype.get_flag=function(e){return this.flag[e]},q.prototype.get_flag=function(e){return this.session.get_flag(e)},C.prototype.add_rule=function(e,r){return(r=r||{}).from=r.from?r.from:"$tau-js",this.src_predicates[e.head.indicator]=r.from,this.rules[e.head.indicator]||(this.rules[e.head.indicator]=[]),this.rules[e.head.indicator].push(e),this.public_predicates.hasOwnProperty(e.head.indicator)||(this.public_predicates[e.head.indicator]=!1),!0},q.prototype.add_rule=function(e,r){return this.session.add_rule(e,r)},C.prototype.run_directive=function(e){this.thread.run_directive(e)},q.prototype.run_directive=function(e){return!!J.type.is_directive(e)&&(J.directive[e.indicator](this,e),!0)},C.prototype.__get_max_priority=function(){return"1200"},q.prototype.__get_max_priority=function(){return this.session.__get_max_priority()},C.prototype.__get_next_priority=function(e){var r=0;for(var t in e=parseInt(e),this.__operators)if(this.__operators.hasOwnProperty(t)){var n=parseInt(t);n>r&&n<e&&(r=n)}return r.toString()},q.prototype.__get_next_priority=function(e){return this.session.__get_next_priority(e)},C.prototype.__lookup_operator_classes=function(e,r){return this.__operators.hasOwnProperty(e)&&this.__operators[e][r]instanceof Array&&this.__operators[e][r]||!1},q.prototype.__lookup_operator_classes=function(e,r){return this.session.__lookup_operator_classes(e,r)},C.prototype.lookup_operator=function(e,r){for(var t in this.__operators)if(this.__operators[t][e])for(var n=0;n<this.__operators[t][e].length;n++)if(0===r||this.__operators[t][e][n].length===r+1)return{priority:t,class:this.__operators[t][e][n]};return null},q.prototype.lookup_operator=function(e,r){return this.session.lookup_operator(e,r)},C.prototype.throw_warning=function(e){this.thread.throw_warning(e)},q.prototype.throw_warning=function(e){this.warnings.push(e)},C.prototype.get_warnings=function(){return this.thread.get_warnings()},q.prototype.get_warnings=function(){return this.warnings},C.prototype.add_goal=function(e,r){this.thread.add_goal(e,r)},q.prototype.add_goal=function(e,r,t){t=t||null,!0===r&&(this.points=[]);for(var n=e.variables(),i={},a=0;a<n.length;a++)i[n[a]]=new P(n[a]);this.points.push(new R(e,new j(i),t))},C.prototype.consult=function(e,r){return this.thread.consult(e,r)},q.prototype.consult=function(e,r){var t="";if("string"==typeof e){var n=(t=e).length;if(".pl"===t.substring(n-3,n)&&document.getElementById(t)){var i=document.getElementById(t),a=i.getAttribute("type");null!==a&&"text/prolog"===a.replace(/ /g,"").toLowerCase()&&(t=i.text)}}else{if(!e.nodeName)return!1;switch(e.nodeName.toLowerCase()){case"input":case"textarea":t=e.value;break;default:t=e.innerHTML}}return this.warnings=[],function(e,r,t){(t=t||{}).from=t.from?t.from:"$tau-js",t.reconsult=void 0===t.reconsult||t.reconsult;var n,i=new m(e),a={};i.new_text(r);for(var o=0,s=i.get_tokens(o);;){if(null===s||!s[o])break;var l=b(e,s,o);if(0===l.type)return new I("throw",[l.value]);if(null===l.value.body&&"?-/1"===l.value.head.indicator){var u=new q(e.session);u.add_goal(l.value.head.args[0]),u.answer((function(r){J.type.is_error(r)?e.throw_warning(r.args[0]):!1!==r&&null!==r||e.throw_warning(J.warning.failed_goal(l.value.head.args[0],l.len))})),o=l.len;var _=!0}else if(null===l.value.body&&":-/1"===l.value.head.indicator){_=e.run_directive(l.value.head.args[0]);o=l.len,"char_conversion/2"===l.value.head.args[0].indicator&&(s=i.get_tokens(o),o=0)}else{n=l.value.head.indicator,!1===t.reconsult||!0===a[n]||e.is_multifile_predicate(n)||(e.session.rules[n]=p(e.session.rules[n]||[],(function(e){return e.dynamic})),a[n]=!0);_=e.add_rule(l.value,t);o=l.len}if(!_)return _}return!0}(this,t,r)},C.prototype.query=function(e){return this.thread.query(e)},q.prototype.query=function(e){return this.points=[],this.debugger_points=[],function(e,r){var t=new m(e);t.new_text(r);for(var n=0;;){var i=t.get_tokens(n);if(null===i)break;var a=v(e,i,0,e.__get_max_priority(),!1);if(0===a.type)return new I("throw",[a.value]);var o=a.len;if(!i[o]||"atom"!==i[o].name||"."!==i[o].raw){var s=i[o];return new I("throw",[J.error.syntax(s||i[o-1],". or operator expected",!s)])}e.add_goal(T(a.value)),n=a.len+1}return!0}(this,e)},C.prototype.head_point=function(){return this.thread.head_point()},q.prototype.head_point=function(){return this.points[this.points.length-1]},C.prototype.get_free_variable=function(e){return this.thread.get_free_variable(e)},q.prototype.get_free_variable=function(e){var r=[];if("_"===e.id||void 0===this.session.renamed_variables[e.id]){for(this.session.rename++,this.points.length>0&&(r=this.head_point().substitution.domain());-1!==t(r,J.format_variable(this.session.rename));)this.session.rename++;if("_"===e.id)return new P(J.format_variable(this.session.rename));this.session.renamed_variables[e.id]=J.format_variable(this.session.rename)}return new P(this.session.renamed_variables[e.id])},C.prototype.next_free_variable=function(){return this.thread.next_free_variable()},q.prototype.next_free_variable=function(){this.session.rename++;var e=[];for(this.points.length>0&&(e=this.head_point().substitution.domain());-1!==t(e,J.format_variable(this.session.rename));)this.session.rename++;return new P(J.format_variable(this.session.rename))},C.prototype.is_public_predicate=function(e){return!this.public_predicates.hasOwnProperty(e)||!0===this.public_predicates[e]},q.prototype.is_public_predicate=function(e){return this.session.is_public_predicate(e)},C.prototype.is_multifile_predicate=function(e){return this.multifile_predicates.hasOwnProperty(e)&&!0===this.multifile_predicates[e]},q.prototype.is_multifile_predicate=function(e){return this.session.is_multifile_predicate(e)},C.prototype.prepend=function(e){return this.thread.prepend(e)},q.prototype.prepend=function(e){for(var r=e.length-1;r>=0;r--)this.points.push(e[r])},C.prototype.success=function(e,r){return this.thread.success(e,r)},q.prototype.success=function(e,r){r=void 0===r?e:r;this.prepend([new R(e.goal.replace(null),e.substitution,r)])},C.prototype.throw_error=function(e){return this.thread.throw_error(e)},q.prototype.throw_error=function(e){this.prepend([new R(new I("throw",[e]),new j,null,null)])},C.prototype.step_rule=function(e,r){return this.thread.step_rule(e,r)},q.prototype.step_rule=function(e,r){var n=r.indicator;if("user"===e&&(e=null),null===e&&this.session.rules.hasOwnProperty(n))return this.session.rules[n];for(var i=null===e?this.session.modules:-1===t(this.session.modules,e)?[]:[e],a=0;a<i.length;a++){var o=J.module[i[a]];if(o.rules.hasOwnProperty(n)&&(o.rules.hasOwnProperty(this.level)||o.exports_predicate(n)))return J.module[i[a]].rules[n]}return null},C.prototype.step=function(){return this.thread.step()},q.prototype.step=function(){if(0!==this.points.length){var e=!1,r=this.points.pop();if(this.debugger&&this.debugger_states.push(r),J.type.is_term(r.goal)){var t=r.goal.select(),n=null,i=[];if(null!==t){this.total_steps++;for(var a=r;null!==a.parent&&a.parent.goal.search(t);)a=a.parent;if(this.level=null===a.parent?"top_level/0":a.parent.goal.select().indicator,J.type.is_term(t)&&":/2"===t.indicator&&(n=t.args[0].id,t=t.args[1]),null===n&&J.type.is_builtin(t))this.__call_indicator=t.indicator,e=J.predicate[t.indicator](this,r,t);else{var o=this.step_rule(n,t);if(null===o)this.session.rules.hasOwnProperty(t.indicator)||("error"===this.get_flag("unknown").id?this.throw_error(J.error.existence("procedure",t.indicator,this.level)):"warning"===this.get_flag("unknown").id&&this.throw_warning("unknown procedure "+t.indicator+" (from "+this.level+")"));else if(o instanceof Function)e=o(this,r,t);else{for(var s in o)if(o.hasOwnProperty(s)){var p=o[s];this.session.renamed_variables={},p=p.rename(this);var l="true/0"===this.get_flag("occurs_check").indicator,u=new R,_=J.unify(t,p.head,l);null!==_&&(u.goal=r.goal.replace(p.body),null!==u.goal&&(u.goal=u.goal.apply(_)),u.substitution=r.substitution.apply(_),u.parent=r,i.push(u))}this.prepend(i)}}}}else J.type.is_variable(r.goal)?this.throw_error(J.error.instantiation(this.level)):this.throw_error(J.error.type("callable",r.goal,this.level));return e}},C.prototype.answer=function(e){return this.thread.answer(e)},q.prototype.answer=function(e){e=e||function(e){},this.__calls.push(e),this.__calls.length>1||this.again()},C.prototype.answers=function(e,r,t){return this.thread.answers(e,r,t)},q.prototype.answers=function(e,r,t){var n=this;r<=0?t&&t():this.answer((function(i){e(i),!1!==i?setTimeout((function(){n.answers(e,r-1,t)}),1):t&&t()}))},C.prototype.again=function(e){return this.thread.again(e)},q.prototype.again=function(e){for(var r,t=Date.now();this.__calls.length>0;){for(this.warnings=[],!1!==e&&(this.current_limit=this.session.limit);this.current_limit>0&&this.points.length>0&&null!==this.head_point().goal&&!J.type.is_error(this.head_point().goal);)if(this.current_limit--,!0===this.step())return;var n=Date.now();this.cpu_time_last=n-t,this.cpu_time+=this.cpu_time_last;var i=this.__calls.shift();this.current_limit<=0?i(null):0===this.points.length?i(!1):J.type.is_error(this.head_point().goal)?(r=this.session.format_error(this.points.pop()),this.points=[],i(r)):(this.debugger&&this.debugger_states.push(this.head_point()),i(r=this.session.format_success(this.points.pop())))}},C.prototype.unfold=function(e){if(null===e.body)return!1;var r=e.head,n=e.body,i=n.select(),a=new q(this),o=[];a.add_goal(i),a.step();for(var s=a.points.length-1;s>=0;s--){var p=a.points[s],l=r.apply(p.substitution),u=n.replace(p.goal);null!==u&&(u=u.apply(p.substitution)),o.push(new X(l,u))}var _=this.rules[r.indicator],c=t(_,e);return o.length>0&&-1!==c&&(_.splice.apply(_,[c,1].concat(o)),!0)},q.prototype.unfold=function(e){return this.session.unfold(e)},P.prototype.interpret=function(e){return J.error.instantiation(e.level)},E.prototype.interpret=function(e){return this},I.prototype.interpret=function(e){return J.type.is_unitary_list(this)?this.args[0].interpret(e):J.operate(e,this)},P.prototype.compare=function(e){return this.id<e.id?-1:this.id>e.id?1:0},E.prototype.compare=function(e){return this.value===e.value&&this.is_float===e.is_float?0:this.value<e.value||this.value===e.value&&this.is_float&&!e.is_float?-1:this.value>e.value?1:void 0},I.prototype.compare=function(e){if(this.args.length<e.args.length||this.args.length===e.args.length&&this.id<e.id)return-1;if(this.args.length>e.args.length||this.args.length===e.args.length&&this.id>e.id)return 1;for(var r=0;r<this.args.length;r++){var t=J.compare(this.args[r],e.args[r]);if(0!==t)return t}return 0},j.prototype.lookup=function(e){return this.links[e]?this.links[e]:null},j.prototype.filter=function(e){var r={};for(var t in this.links)if(this.links.hasOwnProperty(t)){var n=this.links[t];e(t,n)&&(r[t]=n)}return new j(r)},j.prototype.exclude=function(e){var r={};for(var n in this.links)this.links.hasOwnProperty(n)&&-1===t(e,n)&&(r[n]=this.links[n]);return new j(r)},j.prototype.add=function(e,r){this.links[e]=r},j.prototype.domain=function(e){var r=!0===e?function(e){return e}:function(e){return new P(e)},t=[];for(var n in this.links)t.push(r(n));return t},P.prototype.compile=function(){return'new pl.type.Var("'+this.id.toString()+'")'},E.prototype.compile=function(){return"new pl.type.Num("+this.value.toString()+", "+this.is_float.toString()+")"},I.prototype.compile=function(){return'new pl.type.Term("'+this.id.replace(/"/g,'\\"')+'", ['+s(this.args,(function(e){return e.compile()}))+"])"},X.prototype.compile=function(){return"new pl.type.Rule("+this.head.compile()+", "+(null===this.body?"null":this.body.compile())+")"},C.prototype.compile=function(){var e,r,t=[];for(var n in this.rules)if(this.rules.hasOwnProperty(n)){var i=this.rules[n];r=[],e='"'+n+'": [';for(var a=0;a<i.length;a++)r.push(i[a].compile());e+=r.join(),e+="]",t.push(e)}return"{"+t.join()+"};"},P.prototype.toJavaScript=function(){},E.prototype.toJavaScript=function(){return this.value},I.prototype.toJavaScript=function(){if(0===this.args.length&&"[]/0"!==this.indicator)return this.id;if(J.type.is_list(this)){for(var e,r=[],t=this;"./2"===t.indicator;){if(void 0===(e=t.args[0].toJavaScript()))return;r.push(e),t=t.args[1]}if("[]/0"===t.indicator)return r}},X.prototype.singleton_variables=function(){var e=this.head.variables(),r={},t=[];null!==this.body&&(e=e.concat(this.body.variables()));for(var n=0;n<e.length;n++)void 0===r[e[n]]&&(r[e[n]]=0),r[e[n]]++;for(var i in r)"_"!==i&&1===r[i]&&t.push(i);return t};var J={__env:e.exports?r:window,module:{},version:n,parser:{tokenizer:m,expression:v},utils:{str_indicator:O,codePointAt:l,fromCodePoint:u},statistics:{getCountTerms:function(){return N}},fromJavaScript:{test:{boolean:function(e){return!0===e||!1===e},number:function(e){return"number"==typeof e},string:function(e){return"string"==typeof e},list:function(e){return e instanceof Array},variable:function(e){return void 0===e},any:function(e){return!0}},conversion:{boolean:function(e){return new I(e?"true":"false",[])},number:function(e){return new E(e,e%1!=0)},string:function(e){return new I(e,[])},list:function(e){for(var r,t=[],n=0;n<e.length;n++){if(void 0===(r=J.fromJavaScript.apply(e[n])))return;t.push(r)}return V(t)},variable:function(e){return new P("_")},any:function(e){}},apply:function(e){for(var r in J.fromJavaScript.test)if("any"!==r&&J.fromJavaScript.test[r](e))return J.fromJavaScript.conversion[r](e);return J.fromJavaScript.conversion.any(e)}},type:{Var:P,Num:E,Term:I,Rule:X,State:R,Stream:A,Module:D,Thread:q,Session:C,Substitution:j,order:[P,E,I,A],compare:function(e,r){var n=t(J.type.order,e.constructor),i=t(J.type.order,r.constructor);if(n<i)return-1;if(n>i)return 1;if(e.constructor===E){if(e.is_float&&r.is_float)return 0;if(e.is_float)return-1;if(r.is_float)return 1}return 0},is_substitution:function(e){return e instanceof j},is_state:function(e){return e instanceof R},is_rule:function(e){return e instanceof X},is_variable:function(e){return e instanceof P},is_stream:function(e){return e instanceof A},is_anonymous_var:function(e){return e instanceof P&&"_"===e.id},is_callable:function(e){return e instanceof I},is_number:function(e){return e instanceof E},is_integer:function(e){return e instanceof E&&!e.is_float},is_float:function(e){return e instanceof E&&e.is_float},is_term:function(e){return e instanceof I},is_atom:function(e){return e instanceof I&&0===e.args.length},is_ground:function(e){if(e instanceof P)return!1;if(e instanceof I)for(var r=0;r<e.args.length;r++)if(!J.type.is_ground(e.args[r]))return!1;return!0},is_atomic:function(e){return e instanceof I&&0===e.args.length||e instanceof E},is_compound:function(e){return e instanceof I&&e.args.length>0},is_list:function(e){return e instanceof I&&("[]/0"===e.indicator||"./2"===e.indicator)},is_empty_list:function(e){return e instanceof I&&"[]/0"===e.indicator},is_non_empty_list:function(e){return e instanceof I&&"./2"===e.indicator},is_fully_list:function(e){for(;e instanceof I&&"./2"===e.indicator;)e=e.args[1];return e instanceof P||e instanceof I&&"[]/0"===e.indicator},is_instantiated_list:function(e){for(;e instanceof I&&"./2"===e.indicator;)e=e.args[1];return e instanceof I&&"[]/0"===e.indicator},is_unitary_list:function(e){return e instanceof I&&"./2"===e.indicator&&e.args[1]instanceof I&&"[]/0"===e.args[1].indicator},is_character:function(e){return e instanceof I&&(1===e.id.length||e.id.length>0&&e.id.length<=2&&l(e.id,0)>=65536)},is_character_code:function(e){return e instanceof E&&!e.is_float&&e.value>=0&&e.value<=1114111},is_byte:function(e){return e instanceof E&&!e.is_float&&e.value>=0&&e.value<=255},is_operator:function(e){return e instanceof I&&J.arithmetic.evaluation[e.indicator]},is_directive:function(e){return e instanceof I&&void 0!==J.directive[e.indicator]},is_builtin:function(e){return e instanceof I&&void 0!==J.predicate[e.indicator]},is_error:function(e){return e instanceof I&&"throw/1"===e.indicator},is_predicate_indicator:function(e){return e instanceof I&&"//2"===e.indicator&&e.args[0]instanceof I&&0===e.args[0].args.length&&e.args[1]instanceof E&&!1===e.args[1].is_float},is_flag:function(e){return e instanceof I&&0===e.args.length&&void 0!==J.flag[e.id]},is_value_flag:function(e,r){if(!J.type.is_flag(e))return!1;for(var t in J.flag[e.id].allowed)if(J.flag[e.id].allowed.hasOwnProperty(t)&&J.flag[e.id].allowed[t].equals(r))return!0;return!1},is_io_mode:function(e){return J.type.is_atom(e)&&-1!==["read","write","append"].indexOf(e.id)},is_stream_option:function(e){return J.type.is_term(e)&&("alias/1"===e.indicator&&J.type.is_atom(e.args[0])||"reposition/1"===e.indicator&&J.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)||"type/1"===e.indicator&&J.type.is_atom(e.args[0])&&("text"===e.args[0].id||"binary"===e.args[0].id)||"eof_action/1"===e.indicator&&J.type.is_atom(e.args[0])&&("error"===e.args[0].id||"eof_code"===e.args[0].id||"reset"===e.args[0].id))},is_stream_position:function(e){return J.type.is_integer(e)&&e.value>=0||J.type.is_atom(e)&&("end_of_stream"===e.id||"past_end_of_stream"===e.id)},is_stream_property:function(e){return J.type.is_term(e)&&("input/0"===e.indicator||"output/0"===e.indicator||"alias/1"===e.indicator&&(J.type.is_variable(e.args[0])||J.type.is_atom(e.args[0]))||"file_name/1"===e.indicator&&(J.type.is_variable(e.args[0])||J.type.is_atom(e.args[0]))||"position/1"===e.indicator&&(J.type.is_variable(e.args[0])||J.type.is_stream_position(e.args[0]))||"reposition/1"===e.indicator&&(J.type.is_variable(e.args[0])||J.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id))||"type/1"===e.indicator&&(J.type.is_variable(e.args[0])||J.type.is_atom(e.args[0])&&("text"===e.args[0].id||"binary"===e.args[0].id))||"mode/1"===e.indicator&&(J.type.is_variable(e.args[0])||J.type.is_atom(e.args[0])&&("read"===e.args[0].id||"write"===e.args[0].id||"append"===e.args[0].id))||"eof_action/1"===e.indicator&&(J.type.is_variable(e.args[0])||J.type.is_atom(e.args[0])&&("error"===e.args[0].id||"eof_code"===e.args[0].id||"reset"===e.args[0].id))||"end_of_stream/1"===e.indicator&&(J.type.is_variable(e.args[0])||J.type.is_atom(e.args[0])&&("at"===e.args[0].id||"past"===e.args[0].id||"not"===e.args[0].id)))},is_streamable:function(e){return void 0!==e.__proto__.stream},is_read_option:function(e){return J.type.is_term(e)&&-1!==["variables/1","variable_names/1","singletons/1"].indexOf(e.indicator)},is_write_option:function(e){return J.type.is_term(e)&&("quoted/1"===e.indicator&&J.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)||"ignore_ops/1"===e.indicator&&J.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)||"numbervars/1"===e.indicator&&J.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id))},is_close_option:function(e){return J.type.is_term(e)&&"force/1"===e.indicator&&J.type.is_atom(e.args[0])&&("true"===e.args[0].id||"false"===e.args[0].id)},is_modifiable_flag:function(e){return J.type.is_flag(e)&&J.flag[e.id].changeable},is_module:function(e){return e instanceof I&&"library/1"===e.indicator&&e.args[0]instanceof I&&0===e.args[0].args.length&&void 0!==J.module[e.args[0].id]}},arithmetic:{evaluation:{"e/0":{type_args:null,type_result:!0,fn:function(e){return Math.E}},"pi/0":{type_args:null,type_result:!0,fn:function(e){return Math.PI}},"tau/0":{type_args:null,type_result:!0,fn:function(e){return 2*Math.PI}},"epsilon/0":{type_args:null,type_result:!0,fn:function(e){return Number.EPSILON}},"+/1":{type_args:null,type_result:null,fn:function(e,r){return e}},"-/1":{type_args:null,type_result:null,fn:function(e,r){return-e}},"\\/1":{type_args:!1,type_result:!1,fn:function(e,r){return~e}},"abs/1":{type_args:null,type_result:null,fn:function(e,r){return Math.abs(e)}},"sign/1":{type_args:null,type_result:null,fn:function(e,r){return Math.sign(e)}},"float_integer_part/1":{type_args:!0,type_result:!1,fn:function(e,r){return parseInt(e)}},"float_fractional_part/1":{type_args:!0,type_result:!0,fn:function(e,r){return e-parseInt(e)}},"float/1":{type_args:null,type_result:!0,fn:function(e,r){return parseFloat(e)}},"floor/1":{type_args:!0,type_result:!1,fn:function(e,r){return Math.floor(e)}},"truncate/1":{type_args:!0,type_result:!1,fn:function(e,r){return parseInt(e)}},"round/1":{type_args:!0,type_result:!1,fn:function(e,r){return Math.round(e)}},"ceiling/1":{type_args:!0,type_result:!1,fn:function(e,r){return Math.ceil(e)}},"sin/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.sin(e)}},"cos/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.cos(e)}},"tan/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.tan(e)}},"asin/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.asin(e)}},"acos/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.acos(e)}},"atan/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.atan(e)}},"atan2/2":{type_args:null,type_result:!0,fn:function(e,r,t){return Math.atan2(e,r)}},"exp/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.exp(e)}},"sqrt/1":{type_args:null,type_result:!0,fn:function(e,r){return Math.sqrt(e)}},"log/1":{type_args:null,type_result:!0,fn:function(e,r){return e>0?Math.log(e):J.error.evaluation("undefined",r.__call_indicator)}},"+/2":{type_args:null,type_result:null,fn:function(e,r,t){return e+r}},"-/2":{type_args:null,type_result:null,fn:function(e,r,t){return e-r}},"*/2":{type_args:null,type_result:null,fn:function(e,r,t){return e*r}},"//2":{type_args:null,type_result:!0,fn:function(e,r,t){return r?e/r:J.error.evaluation("zero_division",t.__call_indicator)}},"///2":{type_args:!1,type_result:!1,fn:function(e,r,t){return r?parseInt(e/r):J.error.evaluation("zero_division",t.__call_indicator)}},"**/2":{type_args:null,type_result:!0,fn:function(e,r,t){return Math.pow(e,r)}},"^/2":{type_args:null,type_result:null,fn:function(e,r,t){return Math.pow(e,r)}},"<</2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e<<r}},">>/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e>>r}},"/\\/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e&r}},"\\//2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e|r}},"xor/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return e^r}},"rem/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return r?e%r:J.error.evaluation("zero_division",t.__call_indicator)}},"mod/2":{type_args:!1,type_result:!1,fn:function(e,r,t){return r?e-parseInt(e/r)*r:J.error.evaluation("zero_division",t.__call_indicator)}},"max/2":{type_args:null,type_result:null,fn:function(e,r,t){return Math.max(e,r)}},"min/2":{type_args:null,type_result:null,fn:function(e,r,t){return Math.min(e,r)}}}},directive:{"dynamic/1":function(e,r){var t=r.args[0];if(J.type.is_variable(t))e.throw_error(J.error.instantiation(r.indicator));else if(J.type.is_compound(t)&&"//2"===t.indicator)if(J.type.is_variable(t.args[0])||J.type.is_variable(t.args[1]))e.throw_error(J.error.instantiation(r.indicator));else if(J.type.is_atom(t.args[0]))if(J.type.is_integer(t.args[1])){var n=r.args[0].args[0].id+"/"+r.args[0].args[1].value;e.session.public_predicates[n]=!0,e.session.rules[n]||(e.session.rules[n]=[])}else e.throw_error(J.error.type("integer",t.args[1],r.indicator));else e.throw_error(J.error.type("atom",t.args[0],r.indicator));else e.throw_error(J.error.type("predicate_indicator",t,r.indicator))},"multifile/1":function(e,r){var t=r.args[0];J.type.is_variable(t)?e.throw_error(J.error.instantiation(r.indicator)):J.type.is_compound(t)&&"//2"===t.indicator?J.type.is_variable(t.args[0])||J.type.is_variable(t.args[1])?e.throw_error(J.error.instantiation(r.indicator)):J.type.is_atom(t.args[0])?J.type.is_integer(t.args[1])?e.session.multifile_predicates[r.args[0].args[0].id+"/"+r.args[0].args[1].value]=!0:e.throw_error(J.error.type("integer",t.args[1],r.indicator)):e.throw_error(J.error.type("atom",t.args[0],r.indicator)):e.throw_error(J.error.type("predicate_indicator",t,r.indicator))},"set_prolog_flag/2":function(e,r){var t=r.args[0],n=r.args[1];J.type.is_variable(t)||J.type.is_variable(n)?e.throw_error(J.error.instantiation(r.indicator)):J.type.is_atom(t)?J.type.is_flag(t)?J.type.is_value_flag(t,n)?J.type.is_modifiable_flag(t)?e.session.flag[t.id]=n:e.throw_error(J.error.permission("modify","flag",t)):e.throw_error(J.error.domain("flag_value",new I("+",[t,n]),r.indicator)):e.throw_error(J.error.domain("prolog_flag",t,r.indicator)):e.throw_error(J.error.type("atom",t,r.indicator))},"use_module/1":function(e,r){var n=r.args[0];if(J.type.is_variable(n))e.throw_error(J.error.instantiation(r.indicator));else if(J.type.is_term(n)){if(J.type.is_module(n)){var i=n.args[0].id;-1===t(e.session.modules,i)&&e.session.modules.push(i)}}else e.throw_error(J.error.type("term",n,r.indicator))},"char_conversion/2":function(e,r){var t=r.args[0],n=r.args[1];J.type.is_variable(t)||J.type.is_variable(n)?e.throw_error(J.error.instantiation(r.indicator)):J.type.is_character(t)?J.type.is_character(n)?t.id===n.id?delete e.session.__char_conversion[t.id]:e.session.__char_conversion[t.id]=n.id:e.throw_error(J.error.type("character",n,r.indicator)):e.throw_error(J.error.type("character",t,r.indicator))},"op/3":function(e,r){var n=r.args[0],i=r.args[1],a=r.args[2];if(J.type.is_variable(n)||J.type.is_variable(i)||J.type.is_variable(a))e.throw_error(J.error.instantiation(r.indicator));else if(J.type.is_integer(n))if(J.type.is_atom(i))if(J.type.is_atom(a))if(n.value<0||n.value>1200)e.throw_error(J.error.domain("operator_priority",n,r.indicator));else if(","===a.id)e.throw_error(J.error.permission("modify","operator",a,r.indicator));else if("|"===a.id&&(n.value<1001||3!==i.id.length))e.throw_error(J.error.permission("modify","operator",a,r.indicator));else if(-1===["fy","fx","yf","xf","xfx","yfx","xfy"].indexOf(i.id))e.throw_error(J.error.domain("operator_specifier",i,r.indicator));else{var o,s={prefix:null,infix:null,postfix:null};for(var p in e.session.__operators)if(e.session.__operators.hasOwnProperty(p)){var l=e.session.__operators[p][a.id];l&&(-1!==t(l,"fx")&&(s.prefix={priority:p,type:"fx"}),-1!==t(l,"fy")&&(s.prefix={priority:p,type:"fy"}),-1!==t(l,"xf")&&(s.postfix={priority:p,type:"xf"}),-1!==t(l,"yf")&&(s.postfix={priority:p,type:"yf"}),-1!==t(l,"xfx")&&(s.infix={priority:p,type:"xfx"}),-1!==t(l,"xfy")&&(s.infix={priority:p,type:"xfy"}),-1!==t(l,"yfx")&&(s.infix={priority:p,type:"yfx"}))}switch(i.id){case"fy":case"fx":o="prefix";break;case"yf":case"xf":o="postfix";break;default:o="infix"}if(!((s.prefix&&"prefix"===o||s.postfix&&"postfix"===o||s.infix&&"infix"===o)&&s[o].type!==i.id||s.infix&&"postfix"===o||s.postfix&&"infix"===o)||0===n.value)return s[o]&&(!function(e,r){for(var t=e.length-1;t>=0;t--)e[t]===r&&e.splice(t,1)}(e.session.__operators[s[o].priority][a.id],i.id),0===e.session.__operators[s[o].priority][a.id].length&&delete e.session.__operators[s[o].priority][a.id]),n.value>0&&(e.session.__operators[n.value]||(e.session.__operators[n.value.toString()]={}),e.session.__operators[n.value][a.id]||(e.session.__operators[n.value][a.id]=[]),e.session.__operators[n.value][a.id].push(i.id)),!0;e.throw_error(J.error.permission("create","operator",a,r.indicator))}else e.throw_error(J.error.type("atom",a,r.indicator));else e.throw_error(J.error.type("atom",i,r.indicator));else e.throw_error(J.error.type("integer",n,r.indicator))}},predicate:{"op/3":function(e,r,t){J.directive["op/3"](e,t)&&e.success(r)},"current_op/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2],o=[];for(var s in e.session.__operators)for(var p in e.session.__operators[s])for(var l=0;l<e.session.__operators[s][p].length;l++)o.push(new R(r.goal.replace(new I(",",[new I("=",[new E(s,!1),n]),new I(",",[new I("=",[new I(e.session.__operators[s][p][l],[]),i]),new I("=",[new I(p,[]),a])])])),r.substitution,r));e.prepend(o)},";/2":function(e,r,t){var n=t.args[0],i=t.args[1];if(J.type.is_term(n)&&"->/2"===n.indicator){var a=n.args[0],o=n.args[1],s=i,p=r.goal.replace(new I(",",[a,new I(",",[new I("!"),o])])),l=r.goal.replace(new I(",",[new I("!"),s]));e.prepend([new R(r.goal.replace(p),r.substitution,r),new R(r.goal.replace(l),r.substitution,r)])}else{var u=new R(r.goal.replace(n),r.substitution,r),_=new R(r.goal.replace(i),r.substitution,r);e.prepend([u,_])}},"!/0":function(e,r,t){var n,i,a=[];for(n=r,i=null;null!==n.parent&&n.parent.goal.search(t);)if(i=n,null!==(n=n.parent).goal){var o=n.goal.select();if(o&&"call"===o.id&&o.search(t)){n=i;break}}for(var s=e.points.length-1;s>=0;s--){for(var p=e.points[s],l=p.parent;null!==l&&l!==n.parent;)l=l.parent;null===l&&l!==n.parent&&a.push(p)}e.points=a.reverse(),e.success(r)},"\\+/1":function(e,r,t){var n=t.args[0];J.type.is_variable(n)?e.throw_error(J.error.instantiation(e.level)):J.type.is_callable(n)?e.prepend([new R(r.goal.replace(new I(",",[new I(",",[new I("call",[n]),new I("!",[])]),new I("fail",[])])),r.substitution,r),new R(r.goal.replace(null),r.substitution,r)]):e.throw_error(J.error.type("callable",n,e.level))},"->/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=r.goal.replace(new I(",",[n,new I(",",[new I("!"),i])]));e.prepend([new R(a,r.substitution,r)])},"fail/0":function(e,r,t){},"false/0":function(e,r,t){},"true/0":function(e,r,t){e.success(r)},"call/1":k(1),"call/2":k(2),"call/3":k(3),"call/4":k(4),"call/5":k(5),"call/6":k(6),"call/7":k(7),"call/8":k(8),"once/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("call",[n]),new I("!",[])])),r.substitution,r)])},"forall/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I("\\+",[new I(",",[new I("call",[n]),new I("\\+",[new I("call",[i])])])])),r.substitution,r)])},"repeat/0":function(e,r,t){e.prepend([new R(r.goal.replace(null),r.substitution,r),r])},"throw/1":function(e,r,t){J.type.is_variable(t.args[0])?e.throw_error(J.error.instantiation(e.level)):e.throw_error(t.args[0])},"catch/3":function(e,r,t){var n=e.points;e.points=[],e.prepend([new R(t.args[0],r.substitution,r)]);var i=e.session.format_success,a=e.session.format_error;e.session.format_success=function(e){return e.substitution},e.session.format_error=function(e){return e.goal};e.__calls.unshift((function(o){var p=e.points;if(e.points=n,e.session.format_success=i,e.session.format_error=a,J.type.is_error(o)){for(var l=[],u=e.points.length-1;u>=0;u--){for(var _=(y=e.points[u]).parent;null!==_&&_!==r.parent;)_=_.parent;null===_&&_!==r.parent&&l.push(y)}e.points=l;var c="true/0"===e.get_flag("occurs_check").indicator,y=new R,w=J.unify(o.args[0],t.args[1],c);null!==w?(y.substitution=r.substitution.apply(w),y.goal=r.goal.replace(t.args[2]).apply(w),y.parent=r,e.prepend([y])):e.throw_error(o.args[0])}else if(!1!==o){var f=null===o?[]:[new R(r.goal.apply(o).replace(null),r.substitution.apply(o),r)],d=[];for(u=p.length-1;u>=0;u--){d.push(p[u]);var h=null!==p[u].goal?p[u].goal.select():null;if(J.type.is_term(h)&&"!/0"===h.indicator)break}var g=s(d,(function(e){return null===e.goal&&(e.goal=new I("true",[])),(e=new R(r.goal.replace(new I("catch",[e.goal,t.args[1],t.args[2]])),r.substitution.apply(e.substitution),e.parent)).exclude=t.args[0].variables(),e})).reverse();e.prepend(g),e.prepend(f),null===o&&(this.current_limit=0,e.__calls.shift()(null))}}))},"=/2":function(e,r,t){var n="true/0"===e.get_flag("occurs_check").indicator,i=new R,a=J.unify(t.args[0],t.args[1],n);null!==a&&(i.goal=r.goal.apply(a).replace(null),i.substitution=r.substitution.apply(a),i.parent=r,e.prepend([i]))},"unify_with_occurs_check/2":function(e,r,t){var n=new R,i=J.unify(t.args[0],t.args[1],!0);null!==i&&(n.goal=r.goal.apply(i).replace(null),n.substitution=r.substitution.apply(i),n.parent=r,e.prepend([n]))},"\\=/2":function(e,r,t){var n="true/0"===e.get_flag("occurs_check").indicator;null===J.unify(t.args[0],t.args[1],n)&&e.success(r)},"subsumes_term/2":function(e,r,t){var n="true/0"===e.get_flag("occurs_check").indicator,i=J.unify(t.args[1],t.args[0],n);null!==i&&t.args[1].apply(i).equals(t.args[1])&&e.success(r)},"findall/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2];if(J.type.is_variable(i))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_callable(i))if(J.type.is_variable(a)||J.type.is_list(a)){var o=e.next_free_variable(),s=new I(",",[i,new I("=",[o,n])]),p=e.points,l=e.session.limit,u=e.session.format_success;e.session.format_success=function(e){return e.substitution},e.add_goal(s,!0,r);var _=[],c=function(t){if(!1===t||null===t||J.type.is_error(t)){if(e.points=p,e.session.limit=l,e.session.format_success=u,J.type.is_error(t))e.throw_error(t.args[0]);else if(e.current_limit>0){for(var n=new I("[]"),i=_.length-1;i>=0;i--)n=new I(".",[_[i],n]);e.prepend([new R(r.goal.replace(new I("=",[a,n])),r.substitution,r)])}}else e.__calls.unshift(c),_.push(t.links[o.id]),e.session.limit=e.current_limit};e.__calls.unshift(c)}else e.throw_error(J.error.type("list",a,t.indicator));else e.throw_error(J.error.type("callable",i,t.indicator))},"bagof/3":function(e,r,n){var i=n.args[0],a=n.args[1],o=n.args[2];if(J.type.is_variable(a))e.throw_error(J.error.instantiation(n.indicator));else if(J.type.is_callable(a))if(J.type.is_variable(o)||J.type.is_list(o)){var s,p=e.next_free_variable();"^/2"===a.indicator?(s=a.args[0].variables(),a=a.args[1]):s=[],s=s.concat(i.variables());for(var l=a.variables().filter((function(e){return-1===t(s,e)})),u=new I("[]"),_=l.length-1;_>=0;_--)u=new I(".",[new P(l[_]),u]);var c=new I(",",[a,new I("=",[p,new I(",",[u,i])])]),y=e.points,w=e.session.limit,f=e.session.format_success;e.session.format_success=function(e){return e.substitution},e.add_goal(c,!0,r);var d=[],h=function(t){if(!1===t||null===t||J.type.is_error(t)){if(e.points=y,e.session.limit=w,e.session.format_success=f,J.type.is_error(t))e.throw_error(t.args[0]);else if(e.current_limit>0){for(var n=[],i=0;i<d.length;i++){t=d[i].answers;for(var a=new I("[]"),s=t.length-1;s>=0;s--)a=new I(".",[t[s],a]);n.push(new R(r.goal.replace(new I(",",[new I("=",[u,d[i].variables]),new I("=",[o,a])])),r.substitution,r))}e.prepend(n)}}else{e.__calls.unshift(h);var l=!1,_=t.links[p.id].args[0],c=t.links[p.id].args[1];for(var g in d)if(d.hasOwnProperty(g)){var m=d[g];if(m.variables.equals(_)){m.answers.push(c),l=!0;break}}l||d.push({variables:_,answers:[c]}),e.session.limit=e.current_limit}};e.__calls.unshift(h)}else e.throw_error(J.error.type("list",o,n.indicator));else e.throw_error(J.error.type("callable",a,n.indicator))},"setof/3":function(e,r,n){var i=n.args[0],a=n.args[1],o=n.args[2];if(J.type.is_variable(a))e.throw_error(J.error.instantiation(n.indicator));else if(J.type.is_callable(a))if(J.type.is_variable(o)||J.type.is_list(o)){var s,p=e.next_free_variable();"^/2"===a.indicator?(s=a.args[0].variables(),a=a.args[1]):s=[],s=s.concat(i.variables());for(var l=a.variables().filter((function(e){return-1===t(s,e)})),u=new I("[]"),_=l.length-1;_>=0;_--)u=new I(".",[new P(l[_]),u]);var c=new I(",",[a,new I("=",[p,new I(",",[u,i])])]),y=e.points,w=e.session.limit,f=e.session.format_success;e.session.format_success=function(e){return e.substitution},e.add_goal(c,!0,r);var d=[],h=function(t){if(!1===t||null===t||J.type.is_error(t)){if(e.points=y,e.session.limit=w,e.session.format_success=f,J.type.is_error(t))e.throw_error(t.args[0]);else if(e.current_limit>0){for(var n=[],i=0;i<d.length;i++){for(i=(t=d[i].answers.sort(J.compare)).length-1;i>0;i--)t[i].equals(t[i-1])&&t.splice(i,1);for(var a=new I("[]"),s=t.length-1;s>=0;s--)a=new I(".",[t[s],a]);n.push(new R(r.goal.replace(new I(",",[new I("=",[u,d[i].variables]),new I("=",[o,a])])),r.substitution,r))}e.prepend(n)}}else{e.__calls.unshift(h);var l=!1,_=t.links[p.id].args[0],c=t.links[p.id].args[1];for(var g in d)if(d.hasOwnProperty(g)){var m=d[g];if(m.variables.equals(_)){m.answers.push(c),l=!0;break}}l||d.push({variables:_,answers:[c]}),e.session.limit=e.current_limit}};e.__calls.unshift(h)}else e.throw_error(J.error.type("list",o,n.indicator));else e.throw_error(J.error.type("callable",a,n.indicator))},"functor/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2];if(J.type.is_variable(n)&&(J.type.is_variable(i)||J.type.is_variable(a)))e.throw_error(J.error.instantiation("functor/3"));else if(J.type.is_variable(a)||J.type.is_integer(a))if(J.type.is_variable(i)||J.type.is_atomic(i))if(J.type.is_integer(i)&&J.type.is_integer(a)&&0!==a.value)e.throw_error(J.error.type("atom",t.args[1],"functor/3"));else if(J.type.is_variable(n)){if(t.args[2].value>=0){for(var o=[],s=0;s<a.value;s++)o.push(e.next_free_variable());var p=J.type.is_integer(i)?i:new I(i.id,o);e.prepend([new R(r.goal.replace(new I("=",[n,p])),r.substitution,r)])}}else{var l=J.type.is_integer(n)?n:new I(n.id,[]),u=J.type.is_integer(n)?new E(0,!1):new E(n.args.length,!1),_=new I(",",[new I("=",[l,i]),new I("=",[u,a])]);e.prepend([new R(r.goal.replace(_),r.substitution,r)])}else e.throw_error(J.error.type("atomic",t.args[1],"functor/3"));else e.throw_error(J.error.type("integer",t.args[2],"functor/3"))},"arg/3":function(e,r,t){if(J.type.is_variable(t.args[0])||J.type.is_variable(t.args[1]))e.throw_error(J.error.instantiation(t.indicator));else if(t.args[0].value<0)e.throw_error(J.error.domain("not_less_than_zero",t.args[0],t.indicator));else if(J.type.is_compound(t.args[1])){var n=t.args[0].value;if(n>0&&n<=t.args[1].args.length){var i=new I("=",[t.args[1].args[n-1],t.args[2]]);e.prepend([new R(r.goal.replace(i),r.substitution,r)])}}else e.throw_error(J.error.type("compound",t.args[1],t.indicator))},"=../2":function(e,r,t){var n;if(J.type.is_variable(t.args[0])&&(J.type.is_variable(t.args[1])||J.type.is_non_empty_list(t.args[1])&&J.type.is_variable(t.args[1].args[0])))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_fully_list(t.args[1]))if(J.type.is_variable(t.args[0])){if(!J.type.is_variable(t.args[1])){var i=[];for(n=t.args[1].args[1];"./2"===n.indicator;)i.push(n.args[0]),n=n.args[1];J.type.is_variable(t.args[0])&&J.type.is_variable(n)?e.throw_error(J.error.instantiation(t.indicator)):0===i.length&&J.type.is_compound(t.args[1].args[0])?e.throw_error(J.error.type("atomic",t.args[1].args[0],t.indicator)):i.length>0&&(J.type.is_compound(t.args[1].args[0])||J.type.is_number(t.args[1].args[0]))?e.throw_error(J.error.type("atom",t.args[1].args[0],t.indicator)):0===i.length?e.prepend([new R(r.goal.replace(new I("=",[t.args[1].args[0],t.args[0]],r)),r.substitution,r)]):e.prepend([new R(r.goal.replace(new I("=",[new I(t.args[1].args[0].id,i),t.args[0]])),r.substitution,r)])}}else{if(J.type.is_atomic(t.args[0]))n=new I(".",[t.args[0],new I("[]")]);else{n=new I("[]");for(var a=t.args[0].args.length-1;a>=0;a--)n=new I(".",[t.args[0].args[a],n]);n=new I(".",[new I(t.args[0].id),n])}e.prepend([new R(r.goal.replace(new I("=",[n,t.args[1]])),r.substitution,r)])}else e.throw_error(J.error.type("list",t.args[1],t.indicator))},"copy_term/2":function(e,r,t){var n=t.args[0].rename(e);e.prepend([new R(r.goal.replace(new I("=",[n,t.args[1]])),r.substitution,r.parent)])},"term_variables/2":function(e,r,t){var n=t.args[0],i=t.args[1];if(J.type.is_fully_list(i)){var a=V(s(S(n.variables()),(function(e){return new P(e)})));e.prepend([new R(r.goal.replace(new I("=",[i,a])),r.substitution,r)])}else e.throw_error(J.error.type("list",i,t.indicator))},"clause/2":function(e,r,t){if(J.type.is_variable(t.args[0]))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_callable(t.args[0]))if(J.type.is_variable(t.args[1])||J.type.is_callable(t.args[1])){if(void 0!==e.session.rules[t.args[0].indicator])if(e.is_public_predicate(t.args[0].indicator)){var n=[];for(var i in e.session.rules[t.args[0].indicator])if(e.session.rules[t.args[0].indicator].hasOwnProperty(i)){var a=e.session.rules[t.args[0].indicator][i];e.session.renamed_variables={},null===(a=a.rename(e)).body&&(a.body=new I("true"));var o=new I(",",[new I("=",[a.head,t.args[0]]),new I("=",[a.body,t.args[1]])]);n.push(new R(r.goal.replace(o),r.substitution,r))}e.prepend(n)}else e.throw_error(J.error.permission("access","private_procedure",t.args[0].indicator,t.indicator))}else e.throw_error(J.error.type("callable",t.args[1],t.indicator));else e.throw_error(J.error.type("callable",t.args[0],t.indicator))},"current_predicate/1":function(e,r,t){var n=t.args[0];if(J.type.is_variable(n)||J.type.is_compound(n)&&"//2"===n.indicator)if(J.type.is_variable(n)||J.type.is_variable(n.args[0])||J.type.is_atom(n.args[0]))if(J.type.is_variable(n)||J.type.is_variable(n.args[1])||J.type.is_integer(n.args[1])){var i=[];for(var a in e.session.rules)if(e.session.rules.hasOwnProperty(a)){var o=a.lastIndexOf("/"),s=a.substr(0,o),p=parseInt(a.substr(o+1,a.length-(o+1))),l=new I("/",[new I(s),new E(p,!1)]),u=new I("=",[l,n]);i.push(new R(r.goal.replace(u),r.substitution,r))}e.prepend(i)}else e.throw_error(J.error.type("integer",n.args[1],t.indicator));else e.throw_error(J.error.type("atom",n.args[0],t.indicator));else e.throw_error(J.error.type("predicate_indicator",n,t.indicator))},"asserta/1":function(e,r,t){if(J.type.is_variable(t.args[0]))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_callable(t.args[0])){var n,i;":-/2"===t.args[0].indicator?(n=t.args[0].args[0],i=T(t.args[0].args[1])):(n=t.args[0],i=null),J.type.is_callable(n)?null===i||J.type.is_callable(i)?e.is_public_predicate(n.indicator)?(void 0===e.session.rules[n.indicator]&&(e.session.rules[n.indicator]=[]),e.session.public_predicates[n.indicator]=!0,e.session.rules[n.indicator]=[new X(n,i,!0)].concat(e.session.rules[n.indicator]),e.success(r)):e.throw_error(J.error.permission("modify","static_procedure",n.indicator,t.indicator)):e.throw_error(J.error.type("callable",i,t.indicator)):e.throw_error(J.error.type("callable",n,t.indicator))}else e.throw_error(J.error.type("callable",t.args[0],t.indicator))},"assertz/1":function(e,r,t){if(J.type.is_variable(t.args[0]))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_callable(t.args[0])){var n,i;":-/2"===t.args[0].indicator?(n=t.args[0].args[0],i=T(t.args[0].args[1])):(n=t.args[0],i=null),J.type.is_callable(n)?null===i||J.type.is_callable(i)?e.is_public_predicate(n.indicator)?(void 0===e.session.rules[n.indicator]&&(e.session.rules[n.indicator]=[]),e.session.public_predicates[n.indicator]=!0,e.session.rules[n.indicator].push(new X(n,i,!0)),e.success(r)):e.throw_error(J.error.permission("modify","static_procedure",n.indicator,t.indicator)):e.throw_error(J.error.type("callable",i,t.indicator)):e.throw_error(J.error.type("callable",n,t.indicator))}else e.throw_error(J.error.type("callable",t.args[0],t.indicator))},"retract/1":function(e,r,t){if(J.type.is_variable(t.args[0]))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_callable(t.args[0])){var n,i;if(":-/2"===t.args[0].indicator?(n=t.args[0].args[0],i=t.args[0].args[1]):(n=t.args[0],i=new I("true")),void 0===r.retract)if(e.is_public_predicate(n.indicator)){if(void 0!==e.session.rules[n.indicator]){for(var a=[],o=0;o<e.session.rules[n.indicator].length;o++){e.session.renamed_variables={};var s=e.session.rules[n.indicator][o],p=s.rename(e);null===p.body&&(p.body=new I("true",[]));var l="true/0"===e.get_flag("occurs_check").indicator;if(null!==J.unify(new I(",",[n,i]),new I(",",[p.head,p.body]),l)){var u=new R(r.goal.replace(new I(",",[new I("retract",[new I(":-",[n,i])]),new I(",",[new I("=",[n,p.head]),new I("=",[i,p.body])])])),r.substitution,r);u.retract=s,a.push(u)}}e.prepend(a)}}else e.throw_error(J.error.permission("modify","static_procedure",n.indicator,t.indicator));else!function(e,r,t,n){if(null!==e.session.rules[t])for(var i=0;i<e.session.rules[t].length;i++)if(e.session.rules[t][i]===n){e.session.rules[t].splice(i,1),e.success(r);break}}(e,r,n.indicator,r.retract)}else e.throw_error(J.error.type("callable",t.args[0],t.indicator))},"retractall/1":function(e,r,t){var n=t.args[0];J.type.is_variable(n)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_callable(n)?e.prepend([new R(r.goal.replace(new I(",",[new I("retract",[new J.type.Term(":-",[n,new P("_")])]),new I("fail",[])])),r.substitution,r),new R(r.goal.replace(null),r.substitution,r)]):e.throw_error(J.error.type("callable",n,t.indicator))},"abolish/1":function(e,r,t){if(J.type.is_variable(t.args[0])||J.type.is_term(t.args[0])&&"//2"===t.args[0].indicator&&(J.type.is_variable(t.args[0].args[0])||J.type.is_variable(t.args[0].args[1])))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_term(t.args[0])&&"//2"===t.args[0].indicator)if(J.type.is_atom(t.args[0].args[0]))if(J.type.is_integer(t.args[0].args[1]))if(t.args[0].args[1].value<0)e.throw_error(J.error.domain("not_less_than_zero",t.args[0].args[1],t.indicator));else if(J.type.is_number(e.get_flag("max_arity"))&&t.args[0].args[1].value>e.get_flag("max_arity").value)e.throw_error(J.error.representation("max_arity",t.indicator));else{var n=t.args[0].args[0].id+"/"+t.args[0].args[1].value;e.is_public_predicate(n)?(delete e.session.rules[n],e.success(r)):e.throw_error(J.error.permission("modify","static_procedure",n,t.indicator))}else e.throw_error(J.error.type("integer",t.args[0].args[1],t.indicator));else e.throw_error(J.error.type("atom",t.args[0].args[0],t.indicator));else e.throw_error(J.error.type("predicate_indicator",t.args[0],t.indicator))},"atom_length/2":function(e,r,t){if(J.type.is_variable(t.args[0]))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_atom(t.args[0]))if(J.type.is_variable(t.args[1])||J.type.is_integer(t.args[1]))if(J.type.is_integer(t.args[1])&&t.args[1].value<0)e.throw_error(J.error.domain("not_less_than_zero",t.args[1],t.indicator));else{var n=new E(_(t.args[0].id),!1);e.prepend([new R(r.goal.replace(new I("=",[n,t.args[1]])),r.substitution,r)])}else e.throw_error(J.error.type("integer",t.args[1],t.indicator));else e.throw_error(J.error.type("atom",t.args[0],t.indicator))},"atom_concat/3":function(e,r,t){var n,i,a=t.args[0],o=t.args[1],s=t.args[2];if(J.type.is_variable(s)&&(J.type.is_variable(a)||J.type.is_variable(o)))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(a)||J.type.is_atom(a))if(J.type.is_variable(o)||J.type.is_atom(o))if(J.type.is_variable(s)||J.type.is_atom(s)){var p=J.type.is_variable(a),l=J.type.is_variable(o);if(p||l)if(p&&!l)(n=s.id.substr(0,s.id.length-o.id.length))+o.id===s.id&&(i=new I("=",[a,new I(n)]),e.prepend([new R(r.goal.replace(i),r.substitution,r)]));else if(l&&!p)n=s.id.substr(a.id.length),a.id+n===s.id&&(i=new I("=",[o,new I(n)]),e.prepend([new R(r.goal.replace(i),r.substitution,r)]));else{for(var u=[],_=0;_<=s.id.length;_++){var c=new I(s.id.substr(0,_)),y=new I(s.id.substr(_));i=new I(",",[new I("=",[c,a]),new I("=",[y,o])]),u.push(new R(r.goal.replace(i),r.substitution,r))}e.prepend(u)}else i=new I("=",[s,new I(a.id+o.id)]),e.prepend([new R(r.goal.replace(i),r.substitution,r)])}else e.throw_error(J.error.type("atom",s,t.indicator));else e.throw_error(J.error.type("atom",o,t.indicator));else e.throw_error(J.error.type("atom",a,t.indicator))},"sub_atom/5":function(e,r,n){var i,a=n.args[0],o=n.args[1],s=n.args[2],p=n.args[3],l=n.args[4];if(J.type.is_variable(a))e.throw_error(J.error.instantiation(n.indicator));else if(J.type.is_variable(o)||J.type.is_integer(o))if(J.type.is_variable(s)||J.type.is_integer(s))if(J.type.is_variable(p)||J.type.is_integer(p))if(J.type.is_integer(o)&&o.value<0)e.throw_error(J.error.domain("not_less_than_zero",o,n.indicator));else if(J.type.is_integer(s)&&s.value<0)e.throw_error(J.error.domain("not_less_than_zero",s,n.indicator));else if(J.type.is_integer(p)&&p.value<0)e.throw_error(J.error.domain("not_less_than_zero",p,n.indicator));else{var u=[],_=[],c=[];if(J.type.is_variable(o))for(i=0;i<=a.id.length;i++)u.push(i);else u.push(o.value);if(J.type.is_variable(s))for(i=0;i<=a.id.length;i++)_.push(i);else _.push(s.value);if(J.type.is_variable(p))for(i=0;i<=a.id.length;i++)c.push(i);else c.push(p.value);var y=[];for(var w in u)if(u.hasOwnProperty(w))for(var f in i=u[w],_)if(_.hasOwnProperty(f)){var d=_[f],h=a.id.length-i-d;if(-1!==t(c,h)&&i+d+h===a.id.length){var g=a.id.substr(i,d);if(a.id===a.id.substr(0,i)+g+a.id.substr(i+d,h)){var m=new I("=",[new I(g),l]),v=new I("=",[o,new E(i)]),b=new I("=",[s,new E(d)]),x=new I("=",[p,new E(h)]),T=new I(",",[new I(",",[new I(",",[v,b]),x]),m]);y.push(new R(r.goal.replace(T),r.substitution,r))}}}e.prepend(y)}else e.throw_error(J.error.type("integer",p,n.indicator));else e.throw_error(J.error.type("integer",s,n.indicator));else e.throw_error(J.error.type("integer",o,n.indicator))},"atom_chars/2":function(e,r,t){var n=t.args[0],i=t.args[1];if(J.type.is_variable(n)&&J.type.is_variable(i))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(n)||J.type.is_atom(n))if(J.type.is_variable(n)){for(var a=i,o=J.type.is_variable(n),s="";"./2"===a.indicator;){if(J.type.is_character(a.args[0]))s+=a.args[0].id;else{if(J.type.is_variable(a.args[0])&&o)return void e.throw_error(J.error.instantiation(t.indicator));if(!J.type.is_variable(a.args[0]))return void e.throw_error(J.error.type("character",a.args[0],t.indicator))}a=a.args[1]}J.type.is_variable(a)&&o?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_empty_list(a)||J.type.is_variable(a)?e.prepend([new R(r.goal.replace(new I("=",[new I(s),n])),r.substitution,r)]):e.throw_error(J.error.type("list",i,t.indicator))}else{for(var p=new I("[]"),l=_(n.id)-1;l>=0;l--)p=new I(".",[new I(n.id.charAt(l)),p]);e.prepend([new R(r.goal.replace(new I("=",[i,p])),r.substitution,r)])}else e.throw_error(J.error.type("atom",n,t.indicator))},"atom_codes/2":function(e,r,t){var n=t.args[0],i=t.args[1];if(J.type.is_variable(n)&&J.type.is_variable(i))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(n)||J.type.is_atom(n))if(J.type.is_variable(n)){for(var a=i,o=J.type.is_variable(n),s="";"./2"===a.indicator;){if(J.type.is_character_code(a.args[0]))s+=u(a.args[0].value);else{if(J.type.is_variable(a.args[0])&&o)return void e.throw_error(J.error.instantiation(t.indicator));if(!J.type.is_variable(a.args[0]))return void e.throw_error(J.error.representation("character_code",t.indicator))}a=a.args[1]}J.type.is_variable(a)&&o?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_empty_list(a)||J.type.is_variable(a)?e.prepend([new R(r.goal.replace(new I("=",[new I(s),n])),r.substitution,r)]):e.throw_error(J.error.type("list",i,t.indicator))}else{for(var p=new I("[]"),c=_(n.id)-1;c>=0;c--)p=new I(".",[new E(l(n.id,c),!1),p]);e.prepend([new R(r.goal.replace(new I("=",[i,p])),r.substitution,r)])}else e.throw_error(J.error.type("atom",n,t.indicator))},"char_code/2":function(e,r,t){var n=t.args[0],i=t.args[1];if(J.type.is_variable(n)&&J.type.is_variable(i))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(n)||J.type.is_character(n))if(J.type.is_variable(i)||J.type.is_integer(i))if(J.type.is_variable(i)||J.type.is_character_code(i))if(J.type.is_variable(i)){var a=new E(l(n.id,0),!1);e.prepend([new R(r.goal.replace(new I("=",[a,i])),r.substitution,r)])}else{var o=new I(u(i.value));e.prepend([new R(r.goal.replace(new I("=",[o,n])),r.substitution,r)])}else e.throw_error(J.error.representation("character_code",t.indicator));else e.throw_error(J.error.type("integer",i,t.indicator));else e.throw_error(J.error.type("character",n,t.indicator))},"number_chars/2":function(e,r,t){var n,i=t.args[0],a=t.args[1];if(J.type.is_variable(i)&&J.type.is_variable(a))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_number(i))if(J.type.is_variable(a)||J.type.is_list(a)){var o=J.type.is_variable(i);if(!J.type.is_variable(a)){var s=a,p=!0;for(n="";"./2"===s.indicator;){if(J.type.is_character(s.args[0]))n+=s.args[0].id;else if(J.type.is_variable(s.args[0]))p=!1;else if(!J.type.is_variable(s.args[0]))return void e.throw_error(J.error.type("character",s.args[0],t.indicator));s=s.args[1]}if(p=p&&J.type.is_empty_list(s),!J.type.is_empty_list(s)&&!J.type.is_variable(s))return void e.throw_error(J.error.type("list",a,t.indicator));if(!p&&o)return void e.throw_error(J.error.instantiation(t.indicator));if(p){if(J.type.is_variable(s)&&o)return void e.throw_error(J.error.instantiation(t.indicator));var l=e.parse(n),u=l.value;return void(!J.type.is_number(u)||l.tokens[l.tokens.length-1].space?e.throw_error(J.error.syntax_by_predicate("parseable_number",t.indicator)):e.prepend([new R(r.goal.replace(new I("=",[i,u])),r.substitution,r)]))}}if(!o){n=i.toString();for(var _=new I("[]"),c=n.length-1;c>=0;c--)_=new I(".",[new I(n.charAt(c)),_]);e.prepend([new R(r.goal.replace(new I("=",[a,_])),r.substitution,r)])}}else e.throw_error(J.error.type("list",a,t.indicator));else e.throw_error(J.error.type("number",i,t.indicator))},"number_codes/2":function(e,r,t){var n,i=t.args[0],a=t.args[1];if(J.type.is_variable(i)&&J.type.is_variable(a))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_number(i))if(J.type.is_variable(a)||J.type.is_list(a)){var o=J.type.is_variable(i);if(!J.type.is_variable(a)){var s=a,p=!0;for(n="";"./2"===s.indicator;){if(J.type.is_character_code(s.args[0]))n+=u(s.args[0].value);else if(J.type.is_variable(s.args[0]))p=!1;else if(!J.type.is_variable(s.args[0]))return void e.throw_error(J.error.type("character_code",s.args[0],t.indicator));s=s.args[1]}if(p=p&&J.type.is_empty_list(s),!J.type.is_empty_list(s)&&!J.type.is_variable(s))return void e.throw_error(J.error.type("list",a,t.indicator));if(!p&&o)return void e.throw_error(J.error.instantiation(t.indicator));if(p){if(J.type.is_variable(s)&&o)return void e.throw_error(J.error.instantiation(t.indicator));var _=e.parse(n),c=_.value;return void(!J.type.is_number(c)||_.tokens[_.tokens.length-1].space?e.throw_error(J.error.syntax_by_predicate("parseable_number",t.indicator)):e.prepend([new R(r.goal.replace(new I("=",[i,c])),r.substitution,r)]))}}if(!o){n=i.toString();for(var y=new I("[]"),w=n.length-1;w>=0;w--)y=new I(".",[new E(l(n,w),!1),y]);e.prepend([new R(r.goal.replace(new I("=",[a,y])),r.substitution,r)])}}else e.throw_error(J.error.type("list",a,t.indicator));else e.throw_error(J.error.type("number",i,t.indicator))},"upcase_atom/2":function(e,r,t){var n=t.args[0],i=t.args[1];J.type.is_variable(n)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_atom(n)?J.type.is_variable(i)||J.type.is_atom(i)?e.prepend([new R(r.goal.replace(new I("=",[i,new I(n.id.toUpperCase(),[])])),r.substitution,r)]):e.throw_error(J.error.type("atom",i,t.indicator)):e.throw_error(J.error.type("atom",n,t.indicator))},"downcase_atom/2":function(e,r,t){var n=t.args[0],i=t.args[1];J.type.is_variable(n)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_atom(n)?J.type.is_variable(i)||J.type.is_atom(i)?e.prepend([new R(r.goal.replace(new I("=",[i,new I(n.id.toLowerCase(),[])])),r.substitution,r)]):e.throw_error(J.error.type("atom",i,t.indicator)):e.throw_error(J.error.type("atom",n,t.indicator))},"atomic_list_concat/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I("atomic_list_concat",[n,new I("",[]),i])),r.substitution,r)])},"atomic_list_concat/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2];if(J.type.is_variable(i)||J.type.is_variable(n)&&J.type.is_variable(a))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(n)||J.type.is_list(n))if(J.type.is_variable(a)||J.type.is_atom(a))if(J.type.is_variable(a)){for(var o="",p=n;J.type.is_term(p)&&"./2"===p.indicator;){if(!J.type.is_atom(p.args[0])&&!J.type.is_number(p.args[0]))return void e.throw_error(J.error.type("atomic",p.args[0],t.indicator));""!==o&&(o+=i.id),J.type.is_atom(p.args[0])?o+=p.args[0].id:o+=""+p.args[0].value,p=p.args[1]}o=new I(o,[]),J.type.is_variable(p)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_term(p)&&"[]/0"===p.indicator?e.prepend([new R(r.goal.replace(new I("=",[o,a])),r.substitution,r)]):e.throw_error(J.error.type("list",n,t.indicator))}else{var l=V(s(a.id.split(i.id),(function(e){return new I(e,[])})));e.prepend([new R(r.goal.replace(new I("=",[l,n])),r.substitution,r)])}else e.throw_error(J.error.type("atom",a,t.indicator));else e.throw_error(J.error.type("list",n,t.indicator))},"@=</2":function(e,r,t){J.compare(t.args[0],t.args[1])<=0&&e.success(r)},"==/2":function(e,r,t){0===J.compare(t.args[0],t.args[1])&&e.success(r)},"\\==/2":function(e,r,t){0!==J.compare(t.args[0],t.args[1])&&e.success(r)},"@</2":function(e,r,t){J.compare(t.args[0],t.args[1])<0&&e.success(r)},"@>/2":function(e,r,t){J.compare(t.args[0],t.args[1])>0&&e.success(r)},"@>=/2":function(e,r,t){J.compare(t.args[0],t.args[1])>=0&&e.success(r)},"compare/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2];if(J.type.is_variable(n)||J.type.is_atom(n))if(J.type.is_atom(n)&&-1===["<",">","="].indexOf(n.id))e.throw_error(J.type.domain("order",n,t.indicator));else{var o=J.compare(i,a);o=0===o?"=":-1===o?"<":">",e.prepend([new R(r.goal.replace(new I("=",[n,new I(o,[])])),r.substitution,r)])}else e.throw_error(J.error.type("atom",n,t.indicator))},"is/2":function(e,r,t){var n=t.args[1].interpret(e);J.type.is_number(n)?e.prepend([new R(r.goal.replace(new I("=",[t.args[0],n],e.level)),r.substitution,r)]):e.throw_error(n)},"between/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2];if(J.type.is_variable(n)||J.type.is_variable(i))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_integer(n))if(J.type.is_integer(i))if(J.type.is_variable(a)||J.type.is_integer(a))if(J.type.is_variable(a)){var o=[new R(r.goal.replace(new I("=",[a,n])),r.substitution,r)];n.value<i.value&&o.push(new R(r.goal.replace(new I("between",[new E(n.value+1,!1),i,a])),r.substitution,r)),e.prepend(o)}else n.value<=a.value&&i.value>=a.value&&e.success(r);else e.throw_error(J.error.type("integer",a,t.indicator));else e.throw_error(J.error.type("integer",i,t.indicator));else e.throw_error(J.error.type("integer",n,t.indicator))},"succ/2":function(e,r,t){var n=t.args[0],i=t.args[1];J.type.is_variable(n)&&J.type.is_variable(i)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_variable(n)||J.type.is_integer(n)?J.type.is_variable(i)||J.type.is_integer(i)?!J.type.is_variable(n)&&n.value<0?e.throw_error(J.error.domain("not_less_than_zero",n,t.indicator)):!J.type.is_variable(i)&&i.value<0?e.throw_error(J.error.domain("not_less_than_zero",i,t.indicator)):(J.type.is_variable(i)||i.value>0)&&(J.type.is_variable(n)?e.prepend([new R(r.goal.replace(new I("=",[n,new E(i.value-1,!1)])),r.substitution,r)]):e.prepend([new R(r.goal.replace(new I("=",[i,new E(n.value+1,!1)])),r.substitution,r)])):e.throw_error(J.error.type("integer",i,t.indicator)):e.throw_error(J.error.type("integer",n,t.indicator))},"=:=/2":function(e,r,t){var n=J.arithmetic_compare(e,t.args[0],t.args[1]);J.type.is_term(n)?e.throw_error(n):0===n&&e.success(r)},"=\\=/2":function(e,r,t){var n=J.arithmetic_compare(e,t.args[0],t.args[1]);J.type.is_term(n)?e.throw_error(n):0!==n&&e.success(r)},"</2":function(e,r,t){var n=J.arithmetic_compare(e,t.args[0],t.args[1]);J.type.is_term(n)?e.throw_error(n):n<0&&e.success(r)},"=</2":function(e,r,t){var n=J.arithmetic_compare(e,t.args[0],t.args[1]);J.type.is_term(n)?e.throw_error(n):n<=0&&e.success(r)},">/2":function(e,r,t){var n=J.arithmetic_compare(e,t.args[0],t.args[1]);J.type.is_term(n)?e.throw_error(n):n>0&&e.success(r)},">=/2":function(e,r,t){var n=J.arithmetic_compare(e,t.args[0],t.args[1]);J.type.is_term(n)?e.throw_error(n):n>=0&&e.success(r)},"var/1":function(e,r,t){J.type.is_variable(t.args[0])&&e.success(r)},"atom/1":function(e,r,t){J.type.is_atom(t.args[0])&&e.success(r)},"atomic/1":function(e,r,t){J.type.is_atomic(t.args[0])&&e.success(r)},"compound/1":function(e,r,t){J.type.is_compound(t.args[0])&&e.success(r)},"integer/1":function(e,r,t){J.type.is_integer(t.args[0])&&e.success(r)},"float/1":function(e,r,t){J.type.is_float(t.args[0])&&e.success(r)},"number/1":function(e,r,t){J.type.is_number(t.args[0])&&e.success(r)},"nonvar/1":function(e,r,t){J.type.is_variable(t.args[0])||e.success(r)},"ground/1":function(e,r,t){0===t.variables().length&&e.success(r)},"acyclic_term/1":function(e,r,t){for(var n=r.substitution.apply(r.substitution),i=t.args[0].variables(),a=0;a<i.length;a++)if(void 0!==r.substitution.links[i[a]]&&!r.substitution.links[i[a]].equals(n.links[i[a]]))return;e.success(r)},"callable/1":function(e,r,t){J.type.is_callable(t.args[0])&&e.success(r)},"is_list/1":function(e,r,t){for(var n=t.args[0];J.type.is_term(n)&&"./2"===n.indicator;)n=n.args[1];J.type.is_term(n)&&"[]/0"===n.indicator&&e.success(r)},"current_input/1":function(e,r,t){var n=t.args[0];J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n)?(J.type.is_atom(n)&&e.get_stream_by_alias(n.id)&&(n=e.get_stream_by_alias(n.id)),e.prepend([new R(r.goal.replace(new I("=",[n,e.get_current_input()])),r.substitution,r)])):e.throw_error(J.error.domain("stream",n,t.indicator))},"current_output/1":function(e,r,t){var n=t.args[0];J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n)?(J.type.is_atom(n)&&e.get_stream_by_alias(n.id)&&(n=e.get_stream_by_alias(n.id)),e.prepend([new R(r.goal.replace(new I("=",[n,e.get_current_output()])),r.substitution,r)])):e.throw_error(J.error.domain("stream_or_alias",n,t.indicator))},"set_input/1":function(e,r,t){var n=t.args[0],i=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);J.type.is_variable(n)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n)?J.type.is_stream(i)?!0===i.output?e.throw_error(J.error.permission("input","stream",n,t.indicator)):(e.set_current_input(i),e.success(r)):e.throw_error(J.error.existence("stream",n,t.indicator)):e.throw_error(J.error.domain("stream_or_alias",n,t.indicator))},"set_output/1":function(e,r,t){var n=t.args[0],i=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);J.type.is_variable(n)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n)?J.type.is_stream(i)?!0===i.input?e.throw_error(J.error.permission("output","stream",n,t.indicator)):(e.set_current_output(i),e.success(r)):e.throw_error(J.error.existence("stream",n,t.indicator)):e.throw_error(J.error.domain("stream_or_alias",n,t.indicator))},"open/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2];e.prepend([new R(r.goal.replace(new I("open",[n,i,a,new I("[]",[])])),r.substitution,r)])},"open/4":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2],o=t.args[3];if(J.type.is_variable(n)||J.type.is_variable(i))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_atom(i))if(J.type.is_list(o))if(J.type.is_variable(a))if(J.type.is_atom(n)||J.type.is_streamable(n))if(J.type.is_io_mode(i)){for(var s,p={},l=o;J.type.is_term(l)&&"./2"===l.indicator;){if(s=l.args[0],J.type.is_variable(s))return void e.throw_error(J.error.instantiation(t.indicator));if(!J.type.is_stream_option(s))return void e.throw_error(J.error.domain("stream_option",s,t.indicator));p[s.id]=s.args[0].id,l=l.args[1]}if("[]/0"!==l.indicator)return void(J.type.is_variable(l)?e.throw_error(J.error.instantiation(t.indicator)):e.throw_error(J.error.type("list",o,t.indicator)));var u,_=p.alias;if(_&&e.get_stream_by_alias(_))return void e.throw_error(J.error.permission("open","source_sink",new I("alias",[new I(_,[])]),t.indicator));if(p.type||(p.type="text"),!1===(u=J.type.is_atom(n)?e.file_system_open(n.id,p.type,i.id):n.stream(p.type,i.id)))return void e.throw_error(J.error.permission("open","source_sink",n,t.indicator));if(null===u)return void e.throw_error(J.error.existence("source_sink",n,t.indicator));var c=new A(u,i.id,p.alias,p.type,"true"===p.reposition,p.eof_action);_?e.session.streams[_]=c:e.session.streams[c.id]=c,e.prepend([new R(r.goal.replace(new I("=",[a,c])),r.substitution,r)])}else e.throw_error(J.error.domain("io_mode",i,t.indicator));else e.throw_error(J.error.domain("source_sink",n,t.indicator));else e.throw_error(J.error.type("variable",a,t.indicator));else e.throw_error(J.error.type("list",o,t.indicator));else e.throw_error(J.error.type("atom",i,t.indicator))},"close/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I("close",[n,new I("[]",[])])),r.substitution,r)])},"close/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n)||J.type.is_variable(i))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_list(i))if(J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(a)&&null!==a.stream){for(var o,s={},p=i;J.type.is_term(p)&&"./2"===p.indicator;){if(o=p.args[0],J.type.is_variable(o))return void e.throw_error(J.error.instantiation(t.indicator));if(!J.type.is_close_option(o))return void e.throw_error(J.error.domain("close_option",o,t.indicator));s[o.id]="true"===o.args[0].id,p=p.args[1]}if("[]/0"!==p.indicator)return void(J.type.is_variable(p)?e.throw_error(J.error.instantiation(t.indicator)):e.throw_error(J.error.type("list",i,t.indicator)));if(a===e.session.standard_input||a===e.session.standard_output)return void e.success(r);a===e.session.current_input?e.session.current_input=e.session.standard_input:a===e.session.current_output&&(e.session.current_output=e.session.current_output),null!==a.alias?delete e.session.streams[a.alias]:delete e.session.streams[a.id],a.output&&a.stream.flush();var l=a.stream.close();a.stream=null,!0!==s.force&&!0!==l||e.success(r)}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("list",i,t.indicator))},"flush_output/0":function(e,r,t){e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("flush_output",[new P("S")])])),r.substitution,r)])},"flush_output/1":function(e,r,t){var n=t.args[0],i=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);J.type.is_variable(n)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_stream(n)||J.type.is_atom(n)?J.type.is_stream(i)&&null!==i.stream?!0===n.input?e.throw_error(J.error.permission("output","stream",output,t.indicator)):(i.stream.flush(),e.success(r)):e.throw_error(J.error.existence("stream",n,t.indicator)):e.throw_error(J.error.domain("stream_or_alias",n,t.indicator))},"stream_property/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_variable(n)||J.type.is_stream(a)&&null!==a.stream)if(J.type.is_variable(i)||J.type.is_stream_property(i)){var o=[],s=[];if(J.type.is_variable(n))for(var p in e.session.streams)o.push(e.session.streams[p]);else o.push(a);for(var l=0;l<o.length;l++){var u=[];o[l].filename&&u.push(new I("file_name",[new I(o[l].file_name,[])])),u.push(new I("mode",[new I(o[l].mode,[])])),u.push(new I(o[l].input?"input":"output",[])),o[l].alias&&u.push(new I("alias",[new I(o[l].alias,[])])),u.push(new I("position",["number"==typeof o[l].position?new E(o[l].position,!1):new I(o[l].position,[])])),u.push(new I("end_of_stream",[new I("end_of_stream"===o[l].position?"at":"past_end_of_stream"===o[l].position?"past":"not",[])])),u.push(new I("eof_action",[new I(o[l].eof_action,[])])),u.push(new I("reposition",[new I(o[l].reposition?"true":"false",[])])),u.push(new I("type",[new I(o[l].type,[])]));for(var _=0;_<u.length;_++)s.push(new R(r.goal.replace(new I(",",[new I("=",[J.type.is_variable(n)?n:a,o[l]]),new I("=",[i,u[_]])])),r.substitution,r))}e.prepend(s)}else e.throw_error(J.error.domain("stream_property",i,t.indicator));else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator))},"at_end_of_stream/0":function(e,r,t){e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I(",",[new I("stream_property",[new P("S"),new I("end_of_stream",[new P("E")])]),new I(",",[new I("!",[]),new I(";",[new I("=",[new P("E"),new I("at",[])]),new I("=",[new P("E"),new I("past",[])])])])])])),r.substitution,r)])},"at_end_of_stream/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("stream_property",[n,new I("end_of_stream",[new P("E")])]),new I(",",[new I("!",[]),new I(";",[new I("=",[new P("E"),new I("at",[])]),new I("=",[new P("E"),new I("past",[])])])])])),r.substitution,r)])},"set_stream_position/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);J.type.is_variable(n)||J.type.is_variable(i)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_stream(n)||J.type.is_atom(n)?J.type.is_stream(a)&&null!==a.stream?J.type.is_stream_position(i)?!1===a.reposition?e.throw_error(J.error.permission("reposition","stream",n,t.indicator)):(J.type.is_integer(i)?a.position=i.value:a.position=i.id,e.success(r)):e.throw_error(J.error.domain("stream_position",i,t.indicator)):e.throw_error(J.error.existence("stream",n,t.indicator)):e.throw_error(J.error.domain("stream_or_alias",n,t.indicator))},"get_char/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I("get_char",[new P("S"),n])])),r.substitution,r)])},"get_char/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_character(i))if(J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(J.error.permission("input","stream",n,t.indicator));else if("binary"===a.type)e.throw_error(J.error.permission("input","binary_stream",n,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(J.error.permission("input","past_end_of_stream",n,t.indicator));else{var o;if("end_of_stream"===a.position)o="end_of_file",a.position="past_end_of_stream";else{if(null===(o=a.stream.get(1,a.position)))return void e.throw_error(J.error.representation("character",t.indicator));a.position++}e.prepend([new R(r.goal.replace(new I("=",[new I(o,[]),i])),r.substitution,r)])}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("in_character",i,t.indicator))},"get_code/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I("get_code",[new P("S"),n])])),r.substitution,r)])},"get_code/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_integer(i))if(J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(J.error.permission("input","stream",n,t.indicator));else if("binary"===a.type)e.throw_error(J.error.permission("input","binary_stream",n,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(J.error.permission("input","past_end_of_stream",n,t.indicator));else{var o;if("end_of_stream"===a.position)o=-1,a.position="past_end_of_stream";else{if(null===(o=a.stream.get(1,a.position)))return void e.throw_error(J.error.representation("character",t.indicator));o=l(o,0),a.position++}e.prepend([new R(r.goal.replace(new I("=",[new E(o,!1),i])),r.substitution,r)])}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("integer",char,t.indicator))},"peek_char/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I("peek_char",[new P("S"),n])])),r.substitution,r)])},"peek_char/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_character(i))if(J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(J.error.permission("input","stream",n,t.indicator));else if("binary"===a.type)e.throw_error(J.error.permission("input","binary_stream",n,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(J.error.permission("input","past_end_of_stream",n,t.indicator));else{var o;if("end_of_stream"===a.position)o="end_of_file",a.position="past_end_of_stream";else if(null===(o=a.stream.get(1,a.position)))return void e.throw_error(J.error.representation("character",t.indicator));e.prepend([new R(r.goal.replace(new I("=",[new I(o,[]),i])),r.substitution,r)])}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("in_character",i,t.indicator))},"peek_code/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I("peek_code",[new P("S"),n])])),r.substitution,r)])},"peek_code/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_integer(i))if(J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(J.error.permission("input","stream",n,t.indicator));else if("binary"===a.type)e.throw_error(J.error.permission("input","binary_stream",n,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(J.error.permission("input","past_end_of_stream",n,t.indicator));else{var o;if("end_of_stream"===a.position)o=-1,a.position="past_end_of_stream";else{if(null===(o=a.stream.get(1,a.position)))return void e.throw_error(J.error.representation("character",t.indicator));o=l(o,0)}e.prepend([new R(r.goal.replace(new I("=",[new E(o,!1),i])),r.substitution,r)])}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("integer",char,t.indicator))},"put_char/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("put_char",[new P("S"),n])])),r.substitution,r)])},"put_char/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);J.type.is_variable(n)||J.type.is_variable(i)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_character(i)?J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n)?J.type.is_stream(a)&&null!==a.stream?a.input?e.throw_error(J.error.permission("output","stream",n,t.indicator)):"binary"===a.type?e.throw_error(J.error.permission("output","binary_stream",n,t.indicator)):a.stream.put(i.id,a.position)&&("number"==typeof a.position&&a.position++,e.success(r)):e.throw_error(J.error.existence("stream",n,t.indicator)):e.throw_error(J.error.domain("stream_or_alias",n,t.indicator)):e.throw_error(J.error.type("character",i,t.indicator))},"put_code/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("put_code",[new P("S"),n])])),r.substitution,r)])},"put_code/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);J.type.is_variable(n)||J.type.is_variable(i)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_integer(i)?J.type.is_character_code(i)?J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n)?J.type.is_stream(a)&&null!==a.stream?a.input?e.throw_error(J.error.permission("output","stream",n,t.indicator)):"binary"===a.type?e.throw_error(J.error.permission("output","binary_stream",n,t.indicator)):a.stream.put_char(u(i.value),a.position)&&("number"==typeof a.position&&a.position++,e.success(r)):e.throw_error(J.error.existence("stream",n,t.indicator)):e.throw_error(J.error.domain("stream_or_alias",n,t.indicator)):e.throw_error(J.error.representation("character_code",t.indicator)):e.throw_error(J.error.type("integer",i,t.indicator))},"nl/0":function(e,r,t){e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("put_char",[new P("S"),new I("\n",[])])])),r.substitution,r)])},"nl/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I("put_char",[n,new I("\n",[])])),r.substitution,r)])},"get_byte/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I("get_byte",[new P("S"),n])])),r.substitution,r)])},"get_byte/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_byte(i))if(J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(J.error.permission("input","stream",n,t.indicator));else if("text"===a.type)e.throw_error(J.error.permission("input","text_stream",n,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(J.error.permission("input","past_end_of_stream",n,t.indicator));else{var o;if("end_of_stream"===a.position)o="end_of_file",a.position="past_end_of_stream";else{if(null===(o=a.stream.get_byte(a.position)))return void e.throw_error(J.error.representation("byte",t.indicator));a.position++}e.prepend([new R(r.goal.replace(new I("=",[new E(o,!1),i])),r.substitution,r)])}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("in_byte",char,t.indicator))},"peek_byte/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I("peek_byte",[new P("S"),n])])),r.substitution,r)])},"peek_byte/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_variable(i)||J.type.is_byte(i))if(J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(a)&&null!==a.stream)if(a.output)e.throw_error(J.error.permission("input","stream",n,t.indicator));else if("text"===a.type)e.throw_error(J.error.permission("input","text_stream",n,t.indicator));else if("past_end_of_stream"===a.position&&"error"===a.eof_action)e.throw_error(J.error.permission("input","past_end_of_stream",n,t.indicator));else{var o;if("end_of_stream"===a.position)o="end_of_file",a.position="past_end_of_stream";else if(null===(o=a.stream.get_byte(a.position)))return void e.throw_error(J.error.representation("byte",t.indicator));e.prepend([new R(r.goal.replace(new I("=",[new E(o,!1),i])),r.substitution,r)])}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("in_byte",char,t.indicator))},"put_byte/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("put_byte",[new P("S"),n])])),r.substitution,r)])},"put_byte/2":function(e,r,t){var n=t.args[0],i=t.args[1],a=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);J.type.is_variable(n)||J.type.is_variable(i)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_byte(i)?J.type.is_variable(n)||J.type.is_stream(n)||J.type.is_atom(n)?J.type.is_stream(a)&&null!==a.stream?a.input?e.throw_error(J.error.permission("output","stream",n,t.indicator)):"text"===a.type?e.throw_error(J.error.permission("output","text_stream",n,t.indicator)):a.stream.put_byte(i.value,a.position)&&("number"==typeof a.position&&a.position++,e.success(r)):e.throw_error(J.error.existence("stream",n,t.indicator)):e.throw_error(J.error.domain("stream_or_alias",n,t.indicator)):e.throw_error(J.error.type("byte",i,t.indicator))},"read/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I("read_term",[new P("S"),n,new I("[]",[])])])),r.substitution,r)])},"read/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I("read_term",[n,i,new I("[]",[])])),r.substitution,r)])},"read_term/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I(",",[new I("current_input",[new P("S")]),new I("read_term",[new P("S"),n,i])])),r.substitution,r)])},"read_term/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2],o=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n)||J.type.is_variable(a))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_list(a))if(J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(o)&&null!==o.stream)if(o.output)e.throw_error(J.error.permission("input","stream",n,t.indicator));else if("binary"===o.type)e.throw_error(J.error.permission("input","binary_stream",n,t.indicator));else if("past_end_of_stream"===o.position&&"error"===o.eof_action)e.throw_error(J.error.permission("input","past_end_of_stream",n,t.indicator));else{for(var p,l={},u=a;J.type.is_term(u)&&"./2"===u.indicator;){if(p=u.args[0],J.type.is_variable(p))return void e.throw_error(J.error.instantiation(t.indicator));if(!J.type.is_read_option(p))return void e.throw_error(J.error.domain("read_option",p,t.indicator));l[p.id]=p.args[0],u=u.args[1]}if("[]/0"!==u.indicator)return void(J.type.is_variable(u)?e.throw_error(J.error.instantiation(t.indicator)):e.throw_error(J.error.type("list",a,t.indicator)));for(var _,c,y,w="",f=[],d=null;null===d||"atom"!==d.name||"."!==d.value||0===y.type&&"token_not_found"===J.flatten_error(new I("throw",[y.value])).found;){if(null===(_=o.stream.get(1,o.position)))return void e.throw_error(J.error.representation("character",t.indicator));if("end_of_file"===_||"past_end_of_file"===_)return void(y?e.throw_error(J.error.syntax(f[y.len-1],". or expression expected",!1)):e.throw_error(J.error.syntax(null,"token not found",!0)));o.position++,w+=_,(c=new m(e)).new_text(w),d=null!==(f=c.get_tokens())&&f.length>0?f[f.length-1]:null,null!==f&&(y=v(e,f,0,e.__get_max_priority(),!1))}if(1===y.type&&y.len===f.length-1&&"."===d.value){var h=new I("=",[i,y=y.value.rename(e)]);if(l.variables){var g=V(s(S(y.variables()),(function(e){return new P(e)})));h=new I(",",[h,new I("=",[l.variables,g])])}if(l.variable_names){g=V(s(S(y.variables()),(function(r){var t;for(t in e.session.renamed_variables)if(e.session.renamed_variables.hasOwnProperty(t)&&e.session.renamed_variables[t]===r)break;return new I("=",[new I(t,[]),new P(r)])})));h=new I(",",[h,new I("=",[l.variable_names,g])])}if(l.singletons){g=V(s(new X(y,null).singleton_variables(),(function(r){var t;for(t in e.session.renamed_variables)if(e.session.renamed_variables.hasOwnProperty(t)&&e.session.renamed_variables[t]===r)break;return new I("=",[new I(t,[]),new P(r)])})));h=new I(",",[h,new I("=",[l.singletons,g])])}e.prepend([new R(r.goal.replace(h),r.substitution,r)])}else 1===y.type?e.throw_error(J.error.syntax(f[y.len],"unexpected token",!1)):e.throw_error(y.value)}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("list",a,t.indicator))},"write/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("write",[new P("S"),n])])),r.substitution,r)])},"write/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I("write_term",[n,i,new I(".",[new I("quoted",[new I("false",[])]),new I(".",[new I("ignore_ops",[new I("false")]),new I(".",[new I("numbervars",[new I("true")]),new I("[]",[])])])])])),r.substitution,r)])},"writeq/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("writeq",[new P("S"),n])])),r.substitution,r)])},"writeq/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I("write_term",[n,i,new I(".",[new I("quoted",[new I("true",[])]),new I(".",[new I("ignore_ops",[new I("false")]),new I(".",[new I("numbervars",[new I("true")]),new I("[]",[])])])])])),r.substitution,r)])},"write_canonical/1":function(e,r,t){var n=t.args[0];e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("write_canonical",[new P("S"),n])])),r.substitution,r)])},"write_canonical/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I("write_term",[n,i,new I(".",[new I("quoted",[new I("true",[])]),new I(".",[new I("ignore_ops",[new I("true")]),new I(".",[new I("numbervars",[new I("false")]),new I("[]",[])])])])])),r.substitution,r)])},"write_term/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I(",",[new I("current_output",[new P("S")]),new I("write_term",[new P("S"),n,i])])),r.substitution,r)])},"write_term/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2],o=J.type.is_stream(n)?n:e.get_stream_by_alias(n.id);if(J.type.is_variable(n)||J.type.is_variable(a))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_list(a))if(J.type.is_stream(n)||J.type.is_atom(n))if(J.type.is_stream(o)&&null!==o.stream)if(o.input)e.throw_error(J.error.permission("output","stream",n,t.indicator));else if("binary"===o.type)e.throw_error(J.error.permission("output","binary_stream",n,t.indicator));else if("past_end_of_stream"===o.position&&"error"===o.eof_action)e.throw_error(J.error.permission("output","past_end_of_stream",n,t.indicator));else{for(var s,p={},l=a;J.type.is_term(l)&&"./2"===l.indicator;){if(s=l.args[0],J.type.is_variable(s))return void e.throw_error(J.error.instantiation(t.indicator));if(!J.type.is_write_option(s))return void e.throw_error(J.error.domain("write_option",s,t.indicator));p[s.id]="true"===s.args[0].id,l=l.args[1]}if("[]/0"!==l.indicator)return void(J.type.is_variable(l)?e.throw_error(J.error.instantiation(t.indicator)):e.throw_error(J.error.type("list",a,t.indicator)));p.session=e.session;var u=i.toString(p);o.stream.put(u,o.position),"number"==typeof o.position&&(o.position+=u.length),e.success(r)}else e.throw_error(J.error.existence("stream",n,t.indicator));else e.throw_error(J.error.domain("stream_or_alias",n,t.indicator));else e.throw_error(J.error.type("list",a,t.indicator))},"halt/0":function(e,r,t){e.points=[]},"halt/1":function(e,r,t){var n=t.args[0];J.type.is_variable(n)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_integer(n)?e.points=[]:e.throw_error(J.error.type("integer",n,t.indicator))},"current_prolog_flag/2":function(e,r,t){var n=t.args[0],i=t.args[1];if(J.type.is_variable(n)||J.type.is_atom(n))if(J.type.is_variable(n)||J.type.is_flag(n)){var a=[];for(var o in J.flag)if(J.flag.hasOwnProperty(o)){var s=new I(",",[new I("=",[new I(o),n]),new I("=",[e.get_flag(o),i])]);a.push(new R(r.goal.replace(s),r.substitution,r))}e.prepend(a)}else e.throw_error(J.error.domain("prolog_flag",n,t.indicator));else e.throw_error(J.error.type("atom",n,t.indicator))},"set_prolog_flag/2":function(e,r,t){var n=t.args[0],i=t.args[1];J.type.is_variable(n)||J.type.is_variable(i)?e.throw_error(J.error.instantiation(t.indicator)):J.type.is_atom(n)?J.type.is_flag(n)?J.type.is_value_flag(n,i)?J.type.is_modifiable_flag(n)?(e.session.flag[n.id]=i,e.success(r)):e.throw_error(J.error.permission("modify","flag",n)):e.throw_error(J.error.domain("flag_value",new I("+",[n,i]),t.indicator)):e.throw_error(J.error.domain("prolog_flag",n,t.indicator)):e.throw_error(J.error.type("atom",n,t.indicator))},"phrase/3":function(e,r,t){var n=t.args[0],i=t.args[1],a=t.args[2];if(J.type.is_variable(n))e.throw_error(J.error.instantiation(t.indicator));else if(J.type.is_callable(n)){var o=x(n,i,e);null!==o&&e.prepend([new R(r.goal.replace(new I(",",[o.value,new I("=",[o.variable,a])])),r.substitution,r)])}else e.throw_error(J.error.type("callable",n,t.indicator))},"phrase/2":function(e,r,t){var n=t.args[0],i=t.args[1];e.prepend([new R(r.goal.replace(new I("phrase",[n,i,new I("[]",[])])),r.substitution,r)])}},flag:{bounded:{allowed:[new I("true"),new I("false")],value:new I("true"),changeable:!1},max_integer:{allowed:[new E(Number.MAX_SAFE_INTEGER)],value:new E(Number.MAX_SAFE_INTEGER),changeable:!1},min_integer:{allowed:[new E(Number.MIN_SAFE_INTEGER)],value:new E(Number.MIN_SAFE_INTEGER),changeable:!1},integer_rounding_function:{allowed:[new I("down"),new I("toward_zero")],value:new I("toward_zero"),changeable:!1},char_conversion:{allowed:[new I("on"),new I("off")],value:new I("on"),changeable:!0},debug:{allowed:[new I("on"),new I("off")],value:new I("off"),changeable:!0},max_arity:{allowed:[new I("unbounded")],value:new I("unbounded"),changeable:!1},unknown:{allowed:[new I("error"),new I("fail"),new I("warning")],value:new I("error"),changeable:!0},double_quotes:{allowed:[new I("chars"),new I("codes"),new I("atom")],value:new I("codes"),changeable:!0},occurs_check:{allowed:[new I("false"),new I("true")],value:new I("false"),changeable:!0},dialect:{allowed:[new I("tau")],value:new I("tau"),changeable:!1},version_data:{allowed:[new I("tau",[new E(n.major,!1),new E(n.minor,!1),new E(n.patch,!1),new I(n.status)])],value:new I("tau",[new E(n.major,!1),new E(n.minor,!1),new E(n.patch,!1),new I(n.status)]),changeable:!1},nodejs:{allowed:[new I("yes"),new I("no")],value:new I("no"),changeable:!1}},unify:function(e,r,t){t=void 0!==t&&t;for(var n=[{left:e,right:r}],i={};0!==n.length;){var a=n.pop();if(e=a.left,r=a.right,J.type.is_term(e)&&J.type.is_term(r)){if(e.indicator!==r.indicator)return null;for(var o=0;o<e.args.length;o++)n.push({left:e.args[o],right:r.args[o]})}else if(J.type.is_number(e)&&J.type.is_number(r)){if(e.value!==r.value||e.is_float!==r.is_float)return null}else if(J.type.is_variable(e)){if(J.type.is_variable(r)&&e.id===r.id)continue;if(!0===t&&-1!==r.variables().indexOf(e.id))return null;if("_"!==e.id){var s=new j;s.add(e.id,r);for(o=0;o<n.length;o++)n[o].left=n[o].left.apply(s),n[o].right=n[o].right.apply(s);for(var o in i)i[o]=i[o].apply(s);i[e.id]=r}}else if(J.type.is_variable(r))n.push({left:r,right:e});else{if(void 0===e.unify)return null;if(!e.unify(r))return null}}return new j(i)},compare:function(e,r){var t=J.type.compare(e,r);return 0!==t?t:e.compare(r)},arithmetic_compare:function(e,r,t){var n=r.interpret(e);if(J.type.is_number(n)){var i=t.interpret(e);return J.type.is_number(i)?n.value<i.value?-1:n.value>i.value?1:0:i}return n},operate:function(e,r){if(J.type.is_operator(r)){for(var t,n=J.type.is_operator(r),i=[],a=!1,o=0;o<r.args.length;o++){if(t=r.args[o].interpret(e),!J.type.is_number(t))return t;if(null!==n.type_args&&t.is_float!==n.type_args)return J.error.type(n.type_args?"float":"integer",t,e.__call_indicator);i.push(t.value),a=a||t.is_float}return i.push(e),t=J.arithmetic.evaluation[r.indicator].fn.apply(this,i),a=null===n.type_result?a:n.type_result,J.type.is_term(t)?t:t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY?J.error.evaluation("overflow",e.__call_indicator):!1===a&&"true"===e.get_flag("bounded").id&&(t>e.get_flag("max_integer").value||t<e.get_flag("min_integer").value)?J.error.evaluation("int_overflow",e.__call_indicator):new E(t,a)}return J.error.type("evaluable",r.indicator,e.__call_indicator)},error:{existence:function(e,r,t){return"string"==typeof r&&(r=O(r)),new I("error",[new I("existence_error",[new I(e),r]),O(t)])},type:function(e,r,t){return new I("error",[new I("type_error",[new I(e),r]),O(t)])},instantiation:function(e){return new I("error",[new I("instantiation_error"),O(e)])},domain:function(e,r,t){return new I("error",[new I("domain_error",[new I(e),r]),O(t)])},representation:function(e,r){return new I("error",[new I("representation_error",[new I(e)]),O(r)])},permission:function(e,r,t,n){return new I("error",[new I("permission_error",[new I(e),new I(r),t]),O(n)])},evaluation:function(e,r){return new I("error",[new I("evaluation_error",[new I(e)]),O(r)])},syntax:function(e,r,t){e=e||{value:"",line:0,column:0,matches:[""],start:0};var n=t&&e.matches.length>0?e.start+e.matches[0].length:e.start,i=t?new I("token_not_found"):new I("found",[new I(e.value.toString())]),a=new I(".",[new I("line",[new E(e.line+1)]),new I(".",[new I("column",[new E(n+1)]),new I(".",[i,new I("[]",[])])])]);return new I("error",[new I("syntax_error",[new I(r)]),a])},syntax_by_predicate:function(e,r){return new I("error",[new I("syntax_error",[new I(e)]),O(r)])}},warning:{singleton:function(e,r,t){for(var n=new I("[]"),i=e.length-1;i>=0;i--)n=new I(".",[new P(e[i]),n]);return new I("warning",[new I("singleton_variables",[n,O(r)]),new I(".",[new I("line",[new E(t,!1)]),new I("[]")])])},failed_goal:function(e,r){return new I("warning",[new I("failed_goal",[e]),new I(".",[new I("line",[new E(r,!1)]),new I("[]")])])}},format_variable:function(e){return"_"+e},format_answer:function(e,r,t){if(r instanceof C&&(r=r.thread),(t=t||{}).session=r?r.session:void 0,J.type.is_error(e))return"uncaught exception: "+e.args[0].toString();if(!1===e)return"false.";if(null===e)return"limit exceeded ;";var n=0,i="";if(J.type.is_substitution(e)){var a=e.domain(!0);e=e.filter((function(e,r){return!J.type.is_variable(r)||-1!==a.indexOf(r.id)&&e!==r.id}))}for(var o in e.links)e.links.hasOwnProperty(o)&&(n++,""!==i&&(i+=", "),i+=o.toString(t)+" = "+e.links[o].toString(t,{priority:"700",class:"xfx",indicator:"=/2"},"right"));var s=void 0===r||r.points.length>0?" ;":".";return 0===n?"true"+s:i+s},flatten_error:function(e){if(!J.type.is_error(e))return null;e=e.args[0];var r={};return r.type=e.args[0].id,r.thrown="syntax_error"===r.type?null:e.args[1].id,r.expected=null,r.found=null,r.representation=null,r.existence=null,r.existence_type=null,r.line=null,r.column=null,r.permission_operation=null,r.permission_type=null,r.evaluation_type=null,"type_error"===r.type||"domain_error"===r.type?(r.expected=e.args[0].args[0].id,r.found=e.args[0].args[1].toString()):"syntax_error"===r.type?"./2"===e.args[1].indicator?(r.expected=e.args[0].args[0].id,r.found=e.args[1].args[1].args[1].args[0],r.found="token_not_found"===r.found.id?r.found.id:r.found.args[0].id,r.line=e.args[1].args[0].args[0].value,r.column=e.args[1].args[1].args[0].args[0].value):r.thrown=e.args[1].id:"permission_error"===r.type?(r.found=e.args[0].args[2].toString(),r.permission_operation=e.args[0].args[0].id,r.permission_type=e.args[0].args[1].id):"evaluation_error"===r.type?r.evaluation_type=e.args[0].args[0].id:"representation_error"===r.type?r.representation=e.args[0].args[0].id:"existence_error"===r.type&&(r.existence=e.args[0].args[1].toString(),r.existence_type=e.args[0].args[0].id),r},create:function(e){return new J.type.Session(e)}};e.exports=J}()}).call(this,t(20))},95:function(e,r,t){!function(r){var t=["append/2","append/3","member/2","permutation/2","maplist/2","maplist/3","maplist/4","maplist/5","maplist/6","maplist/7","maplist/8","include/3","exclude/3","foldl/4","sum_list/2","max_list/2","min_list/2","prod_list/2","last/2","prefix/2","nth0/3","nth1/3","nth0/4","nth1/4","length/2","replicate/3","select/3","sort/2","msort/2","keysort/2","take/3","drop/3","reverse/2","list_to_set/2"];e.exports=function(e){new(r=e).type.Module("lists",{"append/2":[new r.type.Rule(new r.type.Term("append",[new r.type.Var("X"),new r.type.Var("L")]),new r.type.Term("foldl",[new r.type.Term("append",[]),new r.type.Var("X"),new r.type.Term("[]",[]),new r.type.Var("L")]))],"append/3":[new r.type.Rule(new r.type.Term("append",[new r.type.Term("[]",[]),new r.type.Var("X"),new r.type.Var("X")]),null),new r.type.Rule(new r.type.Term("append",[new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("T")]),new r.type.Var("X"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("S")])]),new r.type.Term("append",[new r.type.Var("T"),new r.type.Var("X"),new r.type.Var("S")]))],"member/2":[new r.type.Rule(new r.type.Term("member",[new r.type.Var("X"),new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("_")])]),null),new r.type.Rule(new r.type.Term("member",[new r.type.Var("X"),new r.type.Term(".",[new r.type.Var("_"),new r.type.Var("Xs")])]),new r.type.Term("member",[new r.type.Var("X"),new r.type.Var("Xs")]))],"permutation/2":[new r.type.Rule(new r.type.Term("permutation",[new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("permutation",[new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("T")]),new r.type.Var("S")]),new r.type.Term(",",[new r.type.Term("permutation",[new r.type.Var("T"),new r.type.Var("P")]),new r.type.Term(",",[new r.type.Term("append",[new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("P")]),new r.type.Term("append",[new r.type.Var("X"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("Y")]),new r.type.Var("S")])])]))],"maplist/2":[new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("_"),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Xs")])]),new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("P"),new r.type.Var("X")]),new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Var("Xs")])]))],"maplist/3":[new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("A"),new r.type.Var("As")]),new r.type.Term(".",[new r.type.Var("B"),new r.type.Var("Bs")])]),new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("P"),new r.type.Var("A"),new r.type.Var("B")]),new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Var("As"),new r.type.Var("Bs")])]))],"maplist/4":[new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("A"),new r.type.Var("As")]),new r.type.Term(".",[new r.type.Var("B"),new r.type.Var("Bs")]),new r.type.Term(".",[new r.type.Var("C"),new r.type.Var("Cs")])]),new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("P"),new r.type.Var("A"),new r.type.Var("B"),new r.type.Var("C")]),new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Var("As"),new r.type.Var("Bs"),new r.type.Var("Cs")])]))],"maplist/5":[new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("A"),new r.type.Var("As")]),new r.type.Term(".",[new r.type.Var("B"),new r.type.Var("Bs")]),new r.type.Term(".",[new r.type.Var("C"),new r.type.Var("Cs")]),new r.type.Term(".",[new r.type.Var("D"),new r.type.Var("Ds")])]),new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("P"),new r.type.Var("A"),new r.type.Var("B"),new r.type.Var("C"),new r.type.Var("D")]),new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Var("As"),new r.type.Var("Bs"),new r.type.Var("Cs"),new r.type.Var("Ds")])]))],"maplist/6":[new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("A"),new r.type.Var("As")]),new r.type.Term(".",[new r.type.Var("B"),new r.type.Var("Bs")]),new r.type.Term(".",[new r.type.Var("C"),new r.type.Var("Cs")]),new r.type.Term(".",[new r.type.Var("D"),new r.type.Var("Ds")]),new r.type.Term(".",[new r.type.Var("E"),new r.type.Var("Es")])]),new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("P"),new r.type.Var("A"),new r.type.Var("B"),new r.type.Var("C"),new r.type.Var("D"),new r.type.Var("E")]),new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Var("As"),new r.type.Var("Bs"),new r.type.Var("Cs"),new r.type.Var("Ds"),new r.type.Var("Es")])]))],"maplist/7":[new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("A"),new r.type.Var("As")]),new r.type.Term(".",[new r.type.Var("B"),new r.type.Var("Bs")]),new r.type.Term(".",[new r.type.Var("C"),new r.type.Var("Cs")]),new r.type.Term(".",[new r.type.Var("D"),new r.type.Var("Ds")]),new r.type.Term(".",[new r.type.Var("E"),new r.type.Var("Es")]),new r.type.Term(".",[new r.type.Var("F"),new r.type.Var("Fs")])]),new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("P"),new r.type.Var("A"),new r.type.Var("B"),new r.type.Var("C"),new r.type.Var("D"),new r.type.Var("E"),new r.type.Var("F")]),new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Var("As"),new r.type.Var("Bs"),new r.type.Var("Cs"),new r.type.Var("Ds"),new r.type.Var("Es"),new r.type.Var("Fs")])]))],"maplist/8":[new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("A"),new r.type.Var("As")]),new r.type.Term(".",[new r.type.Var("B"),new r.type.Var("Bs")]),new r.type.Term(".",[new r.type.Var("C"),new r.type.Var("Cs")]),new r.type.Term(".",[new r.type.Var("D"),new r.type.Var("Ds")]),new r.type.Term(".",[new r.type.Var("E"),new r.type.Var("Es")]),new r.type.Term(".",[new r.type.Var("F"),new r.type.Var("Fs")]),new r.type.Term(".",[new r.type.Var("G"),new r.type.Var("Gs")])]),new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("P"),new r.type.Var("A"),new r.type.Var("B"),new r.type.Var("C"),new r.type.Var("D"),new r.type.Var("E"),new r.type.Var("F"),new r.type.Var("G")]),new r.type.Term("maplist",[new r.type.Var("P"),new r.type.Var("As"),new r.type.Var("Bs"),new r.type.Var("Cs"),new r.type.Var("Ds"),new r.type.Var("Es"),new r.type.Var("Fs"),new r.type.Var("Gs")])]))],"include/3":[new r.type.Rule(new r.type.Term("include",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("include",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("T")]),new r.type.Var("L")]),new r.type.Term(",",[new r.type.Term("=..",[new r.type.Var("P"),new r.type.Var("A")]),new r.type.Term(",",[new r.type.Term("append",[new r.type.Var("A"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Term("[]",[])]),new r.type.Var("B")]),new r.type.Term(",",[new r.type.Term("=..",[new r.type.Var("F"),new r.type.Var("B")]),new r.type.Term(",",[new r.type.Term(";",[new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("F")]),new r.type.Term(",",[new r.type.Term("=",[new r.type.Var("L"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("S")])]),new r.type.Term("!",[])])]),new r.type.Term("=",[new r.type.Var("L"),new r.type.Var("S")])]),new r.type.Term("include",[new r.type.Var("P"),new r.type.Var("T"),new r.type.Var("S")])])])])]))],"exclude/3":[new r.type.Rule(new r.type.Term("exclude",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Term("[]",[])]),null),new r.type.Rule(new r.type.Term("exclude",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("T")]),new r.type.Var("S")]),new r.type.Term(",",[new r.type.Term("exclude",[new r.type.Var("P"),new r.type.Var("T"),new r.type.Var("E")]),new r.type.Term(",",[new r.type.Term("=..",[new r.type.Var("P"),new r.type.Var("L")]),new r.type.Term(",",[new r.type.Term("append",[new r.type.Var("L"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Term("[]",[])]),new r.type.Var("Q")]),new r.type.Term(",",[new r.type.Term("=..",[new r.type.Var("R"),new r.type.Var("Q")]),new r.type.Term(";",[new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("R")]),new r.type.Term(",",[new r.type.Term("!",[]),new r.type.Term("=",[new r.type.Var("S"),new r.type.Var("E")])])]),new r.type.Term("=",[new r.type.Var("S"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("E")])])])])])])]))],"foldl/4":[new r.type.Rule(new r.type.Term("foldl",[new r.type.Var("_"),new r.type.Term("[]",[]),new r.type.Var("I"),new r.type.Var("I")]),null),new r.type.Rule(new r.type.Term("foldl",[new r.type.Var("P"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Var("T")]),new r.type.Var("I"),new r.type.Var("R")]),new r.type.Term(",",[new r.type.Term("=..",[new r.type.Var("P"),new r.type.Var("L")]),new r.type.Term(",",[new r.type.Term("append",[new r.type.Var("L"),new r.type.Term(".",[new r.type.Var("I"),new r.type.Term(".",[new r.type.Var("H"),new r.type.Term(".",[new r.type.Var("X"),new r.type.Term("[]",[])])])]),new r.type.Var("L2")]),new r.type.Term(",",[new r.type.Term("=..",[new r.type.Var("P2"),new r.type.Var("L2")]),new r.type.Term(",",[new r.type.Term("call",[new r.type.Var("P2")]),new r.type.Term("foldl",[new r.type.Var("P"),new r.type.Var("T"),new r.type.Var("X"),new r.type.Var("R")])])])])]))],"select/3":[new r.type.Rule(new r.type.Term("select",[new r.type.Var("E"),new r.type.Term(".",[new r.type.Var("E"),new r.type.Var("Xs")]),new r.type.Var("Xs")]),null),new r.type.Rule(new r.type.Term("select",[new r.type.Var("E"),new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Xs")]),new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Ys")])]),new r.type.Term("select",[new r.type.Var("E"),new r.type.Var("Xs"),new r.type.Var("Ys")]))],"sum_list/2":[new r.type.Rule(new r.type.Term("sum_list",[new r.type.Term("[]",[]),new r.type.Num(0,!1)]),null),new r.type.Rule(new r.type.Term("sum_list",[new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Xs")]),new r.type.Var("S")]),new r.type.Term(",",[new r.type.Term("sum_list",[new r.type.Var("Xs"),new r.type.Var("Y")]),new r.type.Term("is",[new r.type.Var("S"),new r.type.Term("+",[new r.type.Var("X"),new r.type.Var("Y")])])]))],"max_list/2":[new r.type.Rule(new r.type.Term("max_list",[new r.type.Term(".",[new r.type.Var("X"),new r.type.Term("[]",[])]),new r.type.Var("X")]),null),new r.type.Rule(new r.type.Term("max_list",[new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Xs")]),new r.type.Var("S")]),new r.type.Term(",",[new r.type.Term("max_list",[new r.type.Var("Xs"),new r.type.Var("Y")]),new r.type.Term(";",[new r.type.Term(",",[new r.type.Term(">=",[new r.type.Var("X"),new r.type.Var("Y")]),new r.type.Term(",",[new r.type.Term("=",[new r.type.Var("S"),new r.type.Var("X")]),new r.type.Term("!",[])])]),new r.type.Term("=",[new r.type.Var("S"),new r.type.Var("Y")])])]))],"min_list/2":[new r.type.Rule(new r.type.Term("min_list",[new r.type.Term(".",[new r.type.Var("X"),new r.type.Term("[]",[])]),new r.type.Var("X")]),null),new r.type.Rule(new r.type.Term("min_list",[new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Xs")]),new r.type.Var("S")]),new r.type.Term(",",[new r.type.Term("min_list",[new r.type.Var("Xs"),new r.type.Var("Y")]),new r.type.Term(";",[new r.type.Term(",",[new r.type.Term("=<",[new r.type.Var("X"),new r.type.Var("Y")]),new r.type.Term(",",[new r.type.Term("=",[new r.type.Var("S"),new r.type.Var("X")]),new r.type.Term("!",[])])]),new r.type.Term("=",[new r.type.Var("S"),new r.type.Var("Y")])])]))],"prod_list/2":[new r.type.Rule(new r.type.Term("prod_list",[new r.type.Term("[]",[]),new r.type.Num(1,!1)]),null),new r.type.Rule(new r.type.Term("prod_list",[new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Xs")]),new r.type.Var("S")]),new r.type.Term(",",[new r.type.Term("prod_list",[new r.type.Var("Xs"),new r.type.Var("Y")]),new r.type.Term("is",[new r.type.Var("S"),new r.type.Term("*",[new r.type.Var("X"),new r.type.Var("Y")])])]))],"last/2":[new r.type.Rule(new r.type.Term("last",[new r.type.Term(".",[new r.type.Var("X"),new r.type.Term("[]",[])]),new r.type.Var("X")]),null),new r.type.Rule(new r.type.Term("last",[new r.type.Term(".",[new r.type.Var("_"),new r.type.Var("Xs")]),new r.type.Var("X")]),new r.type.Term("last",[new r.type.Var("Xs"),new r.type.Var("X")]))],"prefix/2":[new r.type.Rule(new r.type.Term("prefix",[new r.type.Var("Part"),new r.type.Var("Whole")]),new r.type.Term("append",[new r.type.Var("Part"),new r.type.Var("_"),new r.type.Var("Whole")]))],"nth0/3":[new r.type.Rule(new r.type.Term("nth0",[new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z")]),new r.type.Term(";",[new r.type.Term("->",[new r.type.Term("var",[new r.type.Var("X")]),new r.type.Term("nth",[new r.type.Num(0,!1),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("_")])]),new r.type.Term(",",[new r.type.Term(">=",[new r.type.Var("X"),new r.type.Num(0,!1)]),new r.type.Term(",",[new r.type.Term("nth",[new r.type.Num(0,!1),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("_")]),new r.type.Term("!",[])])])]))],"nth1/3":[new r.type.Rule(new r.type.Term("nth1",[new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z")]),new r.type.Term(";",[new r.type.Term("->",[new r.type.Term("var",[new r.type.Var("X")]),new r.type.Term("nth",[new r.type.Num(1,!1),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("_")])]),new r.type.Term(",",[new r.type.Term(">",[new r.type.Var("X"),new r.type.Num(0,!1)]),new r.type.Term(",",[new r.type.Term("nth",[new r.type.Num(1,!1),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("_")]),new r.type.Term("!",[])])])]))],"nth0/4":[new r.type.Rule(new r.type.Term("nth0",[new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("W")]),new r.type.Term(";",[new r.type.Term("->",[new r.type.Term("var",[new r.type.Var("X")]),new r.type.Term("nth",[new r.type.Num(0,!1),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("W")])]),new r.type.Term(",",[new r.type.Term(">=",[new r.type.Var("X"),new r.type.Num(0,!1)]),new r.type.Term(",",[new r.type.Term("nth",[new r.type.Num(0,!1),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("W")]),new r.type.Term("!",[])])])]))],"nth1/4":[new r.type.Rule(new r.type.Term("nth1",[new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("W")]),new r.type.Term(";",[new r.type.Term("->",[new r.type.Term("var",[new r.type.Var("X")]),new r.type.Term("nth",[new r.type.Num(1,!1),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("W")])]),new r.type.Term(",",[new r.type.Term(">",[new r.type.Var("X"),new r.type.Num(0,!1)]),new r.type.Term(",",[new r.type.Term("nth",[new r.type.Num(1,!1),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z"),new r.type.Var("W")]),new r.type.Term("!",[])])])]))],"nth/5":[new r.type.Rule(new r.type.Term("nth",[new r.type.Var("N"),new r.type.Var("N"),new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Xs")]),new r.type.Var("X"),new r.type.Var("Xs")]),null),new r.type.Rule(new r.type.Term("nth",[new r.type.Var("N"),new r.type.Var("O"),new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Xs")]),new r.type.Var("Y"),new r.type.Term(".",[new r.type.Var("X"),new r.type.Var("Ys")])]),new r.type.Term(",",[new r.type.Term("is",[new r.type.Var("M"),new r.type.Term("+",[new r.type.Var("N"),new r.type.Num(1,!1)])]),new r.type.Term("nth",[new r.type.Var("M"),new r.type.Var("O"),new r.type.Var("Xs"),new r.type.Var("Y"),new r.type.Var("Ys")])]))],"length/2":function(e,t,n){var i=n.args[0],a=n.args[1];if(r.type.is_variable(a)||r.type.is_integer(a))if(r.type.is_integer(a)&&a.value<0)e.throw_error(r.error.domain("not_less_than_zero",a,n.indicator));else{var o=new r.type.Term("length",[i,new r.type.Num(0,!1),a]);r.type.is_integer(a)&&(o=new r.type.Term(",",[o,new r.type.Term("!",[])])),e.prepend([new r.type.State(t.goal.replace(o),t.substitution,t)])}else e.throw_error(r.error.type("integer",a,n.indicator))},"length/3":[new r.type.Rule(new r.type.Term("length",[new r.type.Term("[]",[]),new r.type.Var("N"),new r.type.Var("N")]),null),new r.type.Rule(new r.type.Term("length",[new r.type.Term(".",[new r.type.Var("_"),new r.type.Var("X")]),new r.type.Var("A"),new r.type.Var("N")]),new r.type.Term(",",[new r.type.Term("succ",[new r.type.Var("A"),new r.type.Var("B")]),new r.type.Term("length",[new r.type.Var("X"),new r.type.Var("B"),new r.type.Var("N")])]))],"replicate/3":function(e,t,n){var i=n.args[0],a=n.args[1],o=n.args[2];if(r.type.is_variable(a))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_integer(a))if(a.value<0)e.throw_error(r.error.domain("not_less_than_zero",a,n.indicator));else if(r.type.is_variable(o)||r.type.is_list(o)){for(var s=new r.type.Term("[]"),p=0;p<a.value;p++)s=new r.type.Term(".",[i,s]);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[s,o])),t.substitution,t)])}else e.throw_error(r.error.type("list",o,n.indicator));else e.throw_error(r.error.type("integer",a,n.indicator))},"sort/2":function(e,t,n){var i=n.args[0],a=n.args[1];if(r.type.is_variable(i))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_variable(a)||r.type.is_fully_list(a)){for(var o=[],s=i;"./2"===s.indicator;)o.push(s.args[0]),s=s.args[1];if(r.type.is_variable(s))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_empty_list(s)){for(var p=o.sort(r.compare),l=p.length-1;l>0;l--)p[l].equals(p[l-1])&&p.splice(l,1);var u=new r.type.Term("[]");for(l=p.length-1;l>=0;l--)u=new r.type.Term(".",[p[l],u]);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[u,a])),t.substitution,t)])}else e.throw_error(r.error.type("list",i,n.indicator))}else e.throw_error(r.error.type("list",a,n.indicator))},"msort/2":function(e,t,n){var i=n.args[0],a=n.args[1];if(r.type.is_variable(i))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_variable(a)||r.type.is_fully_list(a)){for(var o=[],s=i;"./2"===s.indicator;)o.push(s.args[0]),s=s.args[1];if(r.type.is_variable(s))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_empty_list(s)){for(var p=o.sort(r.compare),l=new r.type.Term("[]"),u=p.length-1;u>=0;u--)l=new r.type.Term(".",[p[u],l]);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[l,a])),t.substitution,t)])}else e.throw_error(r.error.type("list",i,n.indicator))}else e.throw_error(r.error.type("list",a,n.indicator))},"keysort/2":function(e,t,n){var i=n.args[0],a=n.args[1];if(r.type.is_variable(i))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_variable(a)||r.type.is_fully_list(a)){for(var o,s=[],p=i;"./2"===p.indicator;){if(o=p.args[0],r.type.is_variable(o))return void e.throw_error(r.error.instantiation(n.indicator));if(!r.type.is_term(o)||"-/2"!==o.indicator)return void e.throw_error(r.error.type("pair",o,n.indicator));o.args[0].pair=o.args[1],s.push(o.args[0]),p=p.args[1]}if(r.type.is_variable(p))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_empty_list(p)){for(var l=s.sort(r.compare),u=new r.type.Term("[]"),_=l.length-1;_>=0;_--)u=new r.type.Term(".",[new r.type.Term("-",[l[_],l[_].pair]),u]),delete l[_].pair;e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[u,a])),t.substitution,t)])}else e.throw_error(r.error.type("list",i,n.indicator))}else e.throw_error(r.error.type("list",a,n.indicator))},"take/3":function(e,t,n){var i=n.args[0],a=n.args[1],o=n.args[2];if(r.type.is_variable(a)||r.type.is_variable(i))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_list(a))if(r.type.is_integer(i))if(r.type.is_variable(o)||r.type.is_list(o)){for(var s=i.value,p=[],l=a;s>0&&"./2"===l.indicator;)p.push(l.args[0]),l=l.args[1],s--;if(0===s){var u=new r.type.Term("[]");for(s=p.length-1;s>=0;s--)u=new r.type.Term(".",[p[s],u]);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[u,o])),t.substitution,t)])}}else e.throw_error(r.error.type("list",o,n.indicator));else e.throw_error(r.error.type("integer",i,n.indicator));else e.throw_error(r.error.type("list",a,n.indicator))},"drop/3":function(e,t,n){var i=n.args[0],a=n.args[1],o=n.args[2];if(r.type.is_variable(a)||r.type.is_variable(i))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_list(a))if(r.type.is_integer(i))if(r.type.is_variable(o)||r.type.is_list(o)){for(var s=i.value,p=[],l=a;s>0&&"./2"===l.indicator;)p.push(l.args[0]),l=l.args[1],s--;0===s&&e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[l,o])),t.substitution,t)])}else e.throw_error(r.error.type("list",o,n.indicator));else e.throw_error(r.error.type("integer",i,n.indicator));else e.throw_error(r.error.type("list",a,n.indicator))},"reverse/2":function(e,t,n){var i=n.args[0],a=n.args[1],o=r.type.is_instantiated_list(i),s=r.type.is_instantiated_list(a);if(r.type.is_variable(i)&&r.type.is_variable(a))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_variable(i)||r.type.is_fully_list(i))if(r.type.is_variable(a)||r.type.is_fully_list(a))if(o||s){for(var p=o?i:a,l=new r.type.Term("[]",[]);"./2"===p.indicator;)l=new r.type.Term(".",[p.args[0],l]),p=p.args[1];e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[l,o?a:i])),t.substitution,t)])}else e.throw_error(r.error.instantiation(n.indicator));else e.throw_error(r.error.type("list",a,n.indicator));else e.throw_error(r.error.type("list",i,n.indicator))},"list_to_set/2":function(e,t,n){var i=n.args[0],a=n.args[1];if(r.type.is_variable(i))e.throw_error(r.error.instantiation(n.indicator));else{for(var o=i,s=[];"./2"===o.indicator;)s.push(o.args[0]),o=o.args[1];if(r.type.is_variable(o))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_term(o)&&"[]/0"===o.indicator){for(var p,l=[],u=new r.type.Term("[]",[]),_=0;_<s.length;_++){p=!1;for(var c=0;c<l.length&&!p;c++)p=0===r.compare(s[_],l[c]);p||l.push(s[_])}for(_=l.length-1;_>=0;_--)u=new r.type.Term(".",[l[_],u]);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[a,u])),t.substitution,t)])}else e.throw_error(r.error.type("list",i,n.indicator))}}},t)}}(void 0)},96:function(e,r,t){!function(r){var t=["global/1","apply/3","apply/4","prop/2","prop/3","json_prolog/2","json_atom/2","ajax/3","ajax/4"];e.exports=function(e){(r=e).type.is_js_object=function(e){return e instanceof r.type.JSValue},r.type.order.push(r.type.JSValue),r.type.JSValue=function(e){this.value=e},r.type.JSValue.prototype.toString=function(){return"<javascript>("+(typeof this.value).toLowerCase()+")"},r.type.JSValue.prototype.clone=function(){return new r.type.JSValue(this.value)},r.type.JSValue.prototype.equals=function(e){return r.type.is_js_object(e)&&this.value===e.value},r.type.JSValue.prototype.rename=function(e){return this},r.type.JSValue.prototype.variables=function(){return[]},r.type.JSValue.prototype.apply=function(e){return this},r.type.JSValue.prototype.unify=function(e,t){return r.type.is_js_object(e)&&this.value===e.value?new r.type.State(e,new r.type.Substitution):null},r.type.JSValue.prototype.interpret=function(e){return r.error.instantiation(e)},r.type.JSValue.prototype.compare=function(e){return this.value===e.value?0:this.value<e.value?-1:this.value>e.value?1:void 0},r.type.JSValue.prototype.toJavaScript=function(){return this.value},r.fromJavaScript.conversion.any=function(e){return new r.type.JSValue(e)},r.error.javascript=function(e,t){return new r.type.Term("error",[new r.type.Term("javascript_error",[new r.type.Term(e)]),r.utils.str_indicator(t)])},new r.type.Module("js",{"global/1":function(e,t,n){e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[n.args[0],r.fromJavaScript.apply(r.__env)])),t.substitution,t)])},"apply/3":[new r.type.Rule(new r.type.Term("apply",[new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z")]),new r.type.Term(",",[new r.type.Term("global",[new r.type.Var("G")]),new r.type.Term("apply",[new r.type.Var("G"),new r.type.Var("X"),new r.type.Var("Y"),new r.type.Var("Z")])]))],"apply/4":function(e,t,n){var i=n.args[0],a=n.args[1],o=n.args[2],s=n.args[3];r.type.is_variable(i)||r.type.is_variable(a)||r.type.is_variable(o)?e.throw_error(r.error.instantiation(n.indicator)):r.type.is_atom(a)||r.type.is_js_object(a)&&"function"==typeof a.value?r.type.is_list(o)||e.throw_error(r.error.type("list",o,n.indicator)):e.throw_error(r.error.type("atom_or_JSValueFUNCTION",a,n.indicator));var p=i.toJavaScript(),l=r.type.is_atom(a)?p[a.id]:a.toJavaScript();if("function"==typeof l){for(var u,_,c=o,y=[];"./2"===c.indicator;){if(void 0===(u=c.args[0].toJavaScript()))return void e.throw_error(r.error.domain("javascript_object",c.args[0],n.indicator));y.push(u),c=c.args[1]}if(r.type.is_variable(c))return void e.throw_error(r.error.instantiation(n.indicator));if("[]/0"!==c.indicator)return void e.throw_error(r.error.type("list",o,n.indicator));try{_=l.apply(p,y)}catch(t){return void e.throw_error(r.error.javascript(t.toString(),n.indicator))}_=r.fromJavaScript.apply(_),e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[_,s])),t.substitution,t)])}},"prop/2":[new r.type.Rule(new r.type.Term("prop",[new r.type.Var("X"),new r.type.Var("Y")]),new r.type.Term(",",[new r.type.Term("global",[new r.type.Var("G")]),new r.type.Term("prop",[new r.type.Var("G"),new r.type.Var("X"),new r.type.Var("Y")])]))],"prop/3":function(e,t,n){var i=n.args[0],a=n.args[1],o=n.args[2];if(r.type.is_variable(i))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_variable(a)||r.type.is_atom(a))if(r.type.is_atom(a))void 0!==(s=i.toJavaScript()[a.id])&&(s=r.fromJavaScript.apply(s),e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[s,o])),t.substitution,t)]));else{var s=i.toJavaScript(),p=[];for(var l in s)if(s.hasOwnProperty(l)){var u=r.fromJavaScript.apply(s[l]);p.push(new r.type.State(t.goal.replace(new r.type.Term(",",[new r.type.Term("=",[u,o]),new r.type.Term("=",[new r.type.Term(l,[]),a])])),t.substitution,t))}e.prepend(p)}else e.throw_error(r.error.type("atom",a,n.indicator))},"json_prolog/2":function(e,t,n){var i=n.args[0],a=n.args[1];if(r.type.is_variable(i)&&r.type.is_variable(a))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_variable(i)||r.type.is_js_object(i)&&"object"==typeof i.value)if(r.type.is_variable(a)||r.type.is_list(a))if(r.type.is_variable(a)){var o=r.fromJavaScript.apply(i.value,!0);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[a,o])),t.substitution,t)])}else{var s=new r.type.JSValue(a.toJavaScript());e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[i,s])),t.substitution,t)])}else e.throw_error(r.error.type("list",a,n.indicator));else e.throw_error(r.error.type("JsValueOBJECT",i,n.indicator))},"json_atom/2":function(e,t,n){var i=n.args[0],a=n.args[1];if(r.type.is_variable(i)&&r.type.is_variable(a))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_variable(i)||r.type.is_js_object(i)&&"object"==typeof i.value)if(r.type.is_variable(a)||r.type.is_atom(a))if(r.type.is_variable(a))try{var o=new r.type.Term(JSON.stringify(i.value),[]);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[a,o])),t.substitution,t)])}catch(e){}else try{console.log(JSON.parse(a.id));var s=r.fromJavaScript.apply(JSON.parse(a.id));e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[i,s])),t.substitution,t)])}catch(e){}else e.throw_error(r.error.type("atom",a,n.indicator));else e.throw_error(r.error.type("JsValueOBJECT",i,n.indicator))},"ajax/3":[new r.type.Rule(new r.type.Term("ajax",[new r.type.Var("Method"),new r.type.Var("URL"),new r.type.Var("Response")]),new r.type.Term("ajax",[new r.type.Var("Method"),new r.type.Var("URL"),new r.type.Var("Response"),new r.type.Term("[]",[])]))],"ajax/4":function(e,t,n){var i=n.args[0],a=n.args[1],o=n.args[2],s=n.args[3];if(r.type.is_variable(a)||r.type.is_variable(i)||r.type.is_variable(s))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_atom(a))if(r.type.is_atom(i))if(r.type.is_list(s))if("get"!==i.id&&"post"!==i.id&&"put"!==i.id&&"delete"!==i.id)e.throw_error(r.error.domain("http_method",i,n.indicator));else{for(var p=s,l=null,u=0,_="false",c="true",y=null,w=[],f=new FormData;r.type.is_term(p)&&"./2"===p.indicator;){var d=p.args[0];if(!r.type.is_term(d)||1!==d.args.length)return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));var h=d.args[0];if("type/1"===d.indicator){if(!r.type.is_atom(h)||"text"!==h.id&&"json"!==h.id&&"document"!==h.id)return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));l=h.id}else if("timeout/1"===d.indicator){if(!r.type.is_integer(h)||h.value<0)return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));u=h.value}else if("async/1"===d.indicator){if(!r.type.is_atom(h)||"true"!==h.id&&"false"!==h.id)return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));c=h.id}else if("credentials/1"===d.indicator){if(!r.type.is_atom(h)||"true"!==h.id&&"false"!==h.id)return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));_=h.id}else if("mime/1"===d.indicator){if(!r.type.is_atom(h))return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));y=h.id}else if("headers/1"===d.indicator){if(!r.type.is_list(h))return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));for(var g=h;r.type.is_term(g)&&"./2"===g.indicator;){var m=g.args[0];if(!r.type.is_term(m)||"-/2"!==m.indicator||!r.type.is_atom(m.args[0])||!r.type.is_atom(m.args[1]))return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));w.push({header:m.args[0].id,value:m.args[1].id}),g=g.args[1]}if(r.type.is_variable(g))return void e.throw_error(r.error.instantiation(n.indicator));if(!r.type.is_term(g)||"[]/0"!==g.indicator)return void e.throw_error(r.error.domain("ajax_option",d,n.indicator))}else{if("body/1"!==d.indicator)return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));if(!(r.type.is_list(h)||void 0!==r.type.is_dom_object&&r.type.is_dom_object(h)))return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));if(r.type.is_list(h)){for(g=h;r.type.is_term(g)&&"./2"===g.indicator;){var v=g.args[0];if(!r.type.is_term(v)||"-/2"!==v.indicator||!r.type.is_atom(v.args[0])||!r.type.is_atom(v.args[1]))return void e.throw_error(r.error.domain("ajax_option",d,n.indicator));f.append(v.args[0].id,v.args[1].id),g=g.args[1]}if(r.type.is_variable(g))return void e.throw_error(r.error.instantiation(n.indicator));if(!r.type.is_term(g)||"[]/0"!==g.indicator)return void e.throw_error(r.error.domain("ajax_option",d,n.indicator))}else f=h.value}p=p.args[1]}if(r.type.is_variable(p))return void e.throw_error(r.error.instantiation(n.indicator));if(!r.type.is_term(p)||"[]/0"!==p.indicator)return void e.throw_error(r.error.type("list",s,n.indicator));var b=new XMLHttpRequest;null!==y&&b.overrideMimeType(y);var x=function(){if(4==this.readyState){if(200==this.status){var n=null,i=this.getResponseHeader("Content-Type");if(""===this.responseType||"json"===this.responseType||-1!==i.indexOf("application/json"))try{n=r.fromJavaScript.apply(JSON.parse(this.responseText))}catch(e){}null===n&&("document"!==this.responseType&&""!==this.responseType&&-1===i.indexOf("text/html")&&-1===i.indexOf("application/xml")||null===this.responseXML||void 0===r.type.DOM?""!==this.responseType&&"text"!==this.responseType||(n=new r.type.Term(this.responseText,[])):n=new r.type.DOM(this.responseXML)),null!==n&&e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[o,n])),t.substitution,t)])}"true"===c&&e.again()}};b.onreadystatechange=x,b.open(i.id.toUpperCase(),a.id,"true"===c),null!==l&&"true"===c&&(b.responseType=l),b.withCredentials="true"===_,"true"===c&&(b.timeout=u);for(var T=0;T<w.length;T++)b.setRequestHeader(w[T].header,w[T].value);if(b.send(f),"true"===c)return!0;x.apply(b)}else e.throw_error(r.error.type("list",s,n.indicator));else e.throw_error(r.error.type("atom",i,n.indicator));else e.throw_error(r.error.type("atom",a,n.indicator))}},t)}}(void 0)},97:function(e,r,t){!function(r){var t=["maybe/0","maybe/1","random/1","random/3","random_between/3","random_member/2","random_permutation/2"];e.exports=function(e){new(r=e).type.Module("random",{"maybe/0":function(e,r,t){Math.random()<.5&&e.success(r)},"maybe/1":function(e,r,t){var n=t.args[0];Math.random()<n.value&&e.success(r)},"random/1":function(e,t,n){var i=n.args[0];if(r.type.is_variable(i)||r.type.is_number(i)){var a=Math.random();e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[i,new r.type.Num(a,!0)])),t.substitution,t)])}else e.throw_error(r.error.type("number",i,n.indicator))},"random/3":function(e,t,n){var i=n.args[0],a=n.args[1],o=n.args[2];if(r.type.is_variable(i)||r.type.is_variable(a))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_number(i))if(r.type.is_number(a))if(r.type.is_variable(o)||r.type.is_number(o)){if(i.value<a.value){var s=i.is_float||a.is_float,p=i.value+Math.random()*(a.value-i.value);s||(p=Math.floor(p)),e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[o,new r.type.Num(p,s)])),t.substitution,t)])}}else e.throw_error(r.error.type("number",o,n.indicator));else e.throw_error(r.error.type("number",a,n.indicator));else e.throw_error(r.error.type("number",i,n.indicator))},"random_between/3":function(e,t,n){var i=n.args[0],a=n.args[1],o=n.args[2];if(r.type.is_variable(i)||r.type.is_variable(a))e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_integer(i))if(r.type.is_integer(a))if(r.type.is_variable(o)||r.type.is_integer(o)){if(i.value<a.value){var s=Math.floor(i.value+Math.random()*(a.value-i.value+1));e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[o,new r.type.Num(s,!1)])),t.substitution,t)])}}else e.throw_error(r.error.type("integer",o,n.indicator));else e.throw_error(r.error.type("integer",a,n.indicator));else e.throw_error(r.error.type("integer",i,n.indicator))},"random_member/2":function(e,t,n){var i=n.args[0],a=n.args[1];if(r.type.is_variable(a))e.throw_error(r.error.instantiation(n.indicator));else{for(var o=[],s=a;"./2"===s.indicator;)o.push(s.args[0]),s=s.args[1];if(o.length>0){var p=Math.floor(Math.random()*o.length);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[i,o[p]])),t.substitution,t)])}}},"random_permutation/2":function(e,t,n){var i,a=n.args[0],o=n.args[1],s=r.type.is_instantiated_list(a),p=r.type.is_instantiated_list(o);if(r.type.is_variable(a)&&r.type.is_variable(o)||!s&&!p)e.throw_error(r.error.instantiation(n.indicator));else if(r.type.is_variable(a)||r.type.is_fully_list(a))if(r.type.is_variable(o)||r.type.is_fully_list(o)){for(var l=s?a:o,u=[];"./2"===l.indicator;)u.push(l.args[0]),l=l.args[1];for(i=0;i<u.length;i++){var _=Math.floor(Math.random()*u.length),c=u[i];u[i]=u[_],u[_]=c}var y=new r.type.Term("[]",[]);for(i=u.length-1;i>=0;i--)y=new r.type.Term(".",[u[i],y]);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[y,s?o:a])),t.substitution,t)])}else e.throw_error(r.error.type("list",o,n.indicator));else e.throw_error(r.error.type("list",a,n.indicator))}},t)}}(void 0)},98:function(e,r,t){!function(r){var t=["time/1","statistics/0","statistics/2"],n={atoms:function(e){return new r.type.Num(r.statistics.getCountTerms(),!1)},clauses:function(e){var t=0;for(var n in e.session.rules)e.session.rules[n]instanceof Array&&(t+=e.session.rules[n].length);for(var i=0;i<e.session.modules.length;i++)for(var a=r.module[e.session.modules[i]],o=0;o<a.exports.length;o++){var s=a.rules[a.exports[o]];s instanceof Array&&(t+=s.length)}return new r.type.Num(t,!1)},cputime:function(e){return new r.type.Num(e.cpu_time,!1)},epoch:function(e){return new r.type.Num(e.epoch,!1)},inferences:function(e){return new r.type.Num(e.total_steps,!1)},modules:function(e){return new r.type.Num(e.session.modules.length,!1)},predicates:function(e){for(var t=Object.keys(e.session.rules).length,n=0;n<e.session.modules.length;n++){t+=r.module[e.session.modules[n]].exports.length}return new r.type.Num(t,!1)},runtime:function(e){return new r.type.Term(".",[new r.type.Num(e.cpu_time,!1),new r.type.Term(".",[new r.type.Num(e.cpu_time_last,!1),new r.type.Term("[]",[])])])},threads:function(e){return new r.type.Num(e.session.total_threads,!1)}};e.exports=function(e){new(r=e).type.Module("statistics",{"time/1":function(e,t,n){var i=n.args[0];if(r.type.is_variable(i))e.throw_error(r.error.instantiation(e.level));else if(r.type.is_callable(i)){var a=e.points;e.points=[new r.type.State(i,t.substitution,t)];var o=Date.now(),s=r.statistics.getCountTerms(),p=e.total_steps,l=e.session.format_success,u=e.session.format_error;e.session.format_success=function(e){return e.substitution},e.session.format_error=function(e){return e.goal},e.__calls.unshift((function(n){var i=Date.now(),_=r.statistics.getCountTerms(),c=e.total_steps,y=e.points;if(e.points=a,e.session.format_success=l,e.session.format_error=u,r.type.is_error(n))e.throw_error(n.args[0]);else if(null===n)e.points=a,e.prepend([t]),e.__calls.shift()(null);else if(console.log("% Tau Prolog: executed in "+(i-o)+" milliseconds, "+(_-s)+" atoms created, "+(c-p)+" resolution steps performed."),!1!==n){for(var w=0;w<y.length;w++)null===y[w].goal&&(y[w].goal=new r.type.Term("true",[])),y[w].goal=t.goal.replace(new r.type.Term("time",[y[w].goal]));e.points=a,e.prepend(y),e.prepend([new r.type.State(t.goal.apply(n).replace(null),n,t)])}}))}else e.throw_error(r.error.type("callable",i,e.level))},"statistics/0":function(e,t,i){var a="% Tau Prolog statistics";for(var o in n)a+="\n%%% "+o+": "+n[o](e).toString();e.prepend([new r.type.State(t.goal.replace(new r.type.Term("write",[new r.type.Term(a)])),t.substitution,t)])},"statistics/2":function(e,t,i){var a=i.args[0],o=i.args[1];if(r.type.is_variable(a)||r.type.is_atom(a))if(r.type.is_variable(a)||void 0!==n[a.id])if(r.type.is_variable(a)){var s=[];for(var p in n)l=n[p](e),s.push(new r.type.State(t.goal.replace(new r.type.Term(",",[new r.type.Term("=",[a,new r.type.Term(p,[])]),new r.type.Term("=",[o,l])])),t.substitution,t));e.prepend(s)}else{var l=n[a.id](e);e.prepend([new r.type.State(t.goal.replace(new r.type.Term("=",[o,l])),t.substitution,t)])}else e.throw_error(r.error.domain("statistics_key",a,i.indicator));else e.throw_error(r.error.type("atom",a,i.indicator))}},t)}}(void 0)}});const _LIB$pl=LIB.pl;export{_LIB$pl as pl};